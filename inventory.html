<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å®‰å…¨å¸½åº«å­˜ç®¡ç†ç³»çµ±</title>
<style>
* { box-sizing: border-box; }
body { 
  font-family: "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  padding: 2em;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2em;
  padding-bottom: 1em;
  border-bottom: 3px solid #667eea;
  flex-wrap: wrap;
  gap: 1em;
}
h2 { color: #2c3e50; margin: 0; }
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1em;
  margin-bottom: 2em;
}
.stat-card {
  padding: 1.5em;
  border-radius: 12px;
  color: white;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.stat-card.blue { background: linear-gradient(135deg, #667eea, #764ba2); }
.stat-card.green { background: linear-gradient(135deg, #56ab2f, #a8e063); }
.stat-card.orange { background: linear-gradient(135deg, #f093fb, #f5576c); }
.stat-card.red { background: linear-gradient(135deg, #fa709a, #fee140); }
.stat-value { font-size: 2.5em; font-weight: bold; margin: 0.2em 0; }
.stat-label { opacity: 0.9; font-size: 0.9em; }
button {
  background: #667eea;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}
button:hover { background: #5568d3; transform: translateY(-2px); }
button.success { background: #27ae60; }
button.success:hover { background: #229954; }
button.danger { background: #e74c3c; }
button.danger:hover { background: #c0392b; }
button.warning { background: #f39c12; }
button.warning:hover { background: #e67e22; }
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
th {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 12px;
  text-align: left;
  font-weight: 600;
}
td {
  padding: 12px;
  border-bottom: 1px solid #ecf0f1;
}
tr:hover { background: #f8f9fa; }
.stock-level {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.9em;
}
.stock-good { background: #d4edda; color: #155724; }
.stock-low { background: #fff3cd; color: #856404; }
.stock-critical { background: #f8d7da; color: #721c24; }
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: white;
  padding: 2em;
  border-radius: 15px;
  max-width: 500px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
}
input, select {
  width: 100%;
  padding: 10px;
  margin: 0.5em 0;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 1em;
}
input:focus, select:focus {
  outline: none;
  border-color: #667eea;
}
.search-box {
  margin-bottom: 1em;
  position: relative;
}
.search-box input {
  padding-left: 40px;
}
.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2em;
}
.filter-tabs {
  display: flex;
  gap: 0.5em;
  margin-bottom: 1em;
  flex-wrap: wrap;
}
.filter-tab {
  padding: 8px 16px;
  border: 2px solid #667eea;
  background: white;
  color: #667eea;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s;
}
.filter-tab.active {
  background: #667eea;
  color: white;
}
@media (max-width: 768px) {
  .container { padding: 1em; }
  table { font-size: 0.85em; }
  th, td { padding: 8px; }
  .stat-value { font-size: 2em; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h2>ğŸ“¦ å®‰å…¨å¸½åº«å­˜ç®¡ç†ç³»çµ±</h2>
    <div style="display: flex; gap: 0.5em; flex-wrap: wrap;">
      <button onclick="showAddModal()" class="success">â• æ–°å¢å•†å“</button>
      <button onclick="exportData()" class="warning">ğŸ“Š åŒ¯å‡ºå ±è¡¨</button>
      <button onclick="showStockAlert()">ğŸ”” è£œè²¨æé†’</button>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card blue">
      <div class="stat-label">ç¸½å•†å“æ•¸</div>
      <div class="stat-value" id="totalItems">0</div>
    </div>
    <div class="stat-card green">
      <div class="stat-label">ç¸½åº«å­˜é‡</div>
      <div class="stat-value" id="totalStock">0</div>
    </div>
    <div class="stat-card orange">
      <div class="stat-label">åº«å­˜ç¸½å€¼</div>
      <div class="stat-value" id="totalValue">$0</div>
    </div>
    <div class="stat-card red">
      <div class="stat-label">ä½åº«å­˜é …ç›®</div>
      <div class="stat-value" id="lowStockCount">0</div>
    </div>
  </div>

  <div class="search-box">
    <span class="search-icon">ğŸ”</span>
    <input type="text" id="searchInput" placeholder="æœå°‹å•†å“åç¨±ã€å‹è™Ÿã€å“ç‰Œ...">
  </div>

  <div class="filter-tabs">
    <div class="filter-tab active" onclick="filterBy('all')">å…¨éƒ¨å•†å“</div>
    <div class="filter-tab" onclick="filterBy('helmet')">å®‰å…¨å¸½</div>
    <div class="filter-tab" onclick="filterBy('accessory')">é…ä»¶</div>
    <div class="filter-tab" onclick="filterBy('low')">ä½åº«å­˜</div>
    <div class="filter-tab" onclick="filterBy('critical')">ç¼ºè²¨è­¦ç¤º</div>
  </div>

  <table>
    <thead>
      <tr>
        <th>å‹è™Ÿ</th>
        <th>å“ç‰Œ</th>
        <th>é¡å‹</th>
        <th>åº«å­˜é‡</th>
        <th>å®‰å…¨åº«å­˜</th>
        <th>é€²è²¨æˆæœ¬</th>
        <th>åº«å­˜å€¼</th>
        <th>ç‹€æ…‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="inventoryTable">
      <tr>
        <td colspan="9" style="text-align: center; color: #7f8c8d; padding: 3em;">
          ç›®å‰æ²’æœ‰åº«å­˜è³‡æ–™ï¼Œè«‹é»æ“Šã€Œæ–°å¢å•†å“ã€é–‹å§‹å»ºç«‹åº«å­˜
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- æ–°å¢/ç·¨è¼¯å•†å“ Modal -->
<div id="itemModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">æ–°å¢å•†å“</h3>
    <input type="hidden" id="itemId">
    <label>å‹è™Ÿ/åç¨±ï¼š</label>
    <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šEVO 1200 å…¨ç½©">
    <label>å“ç‰Œï¼š</label>
    <select id="itemBrand">
      <option value="EVO">EVO</option>
      <option value="è¯æ³°">è¯æ³°</option>
      <option value="å…¶ä»–">å…¶ä»–</option>
    </select>
    <label>é¡å‹ï¼š</label>
    <select id="itemType">
      <option value="å…¨ç½©å¼">å…¨ç½©å¼å®‰å…¨å¸½</option>
      <option value="åŠç½©å¼">åŠç½©å¼å®‰å…¨å¸½</option>
      <option value="å››åˆ†ä¹‹ä¸‰">å››åˆ†ä¹‹ä¸‰å®‰å…¨å¸½</option>
      <option value="å…’ç«¥å¸½">å…’ç«¥å®‰å…¨å¸½</option>
      <option value="é¡ç‰‡">é¡ç‰‡é…ä»¶</option>
      <option value="å…§è¥¯">å…§è¥¯é…ä»¶</option>
      <option value="å…¶ä»–é…ä»¶">å…¶ä»–é…ä»¶</option>
    </select>
    <label>ç›®å‰åº«å­˜é‡ï¼š</label>
    <input type="number" id="itemStock" value="0" min="0">
    <label>å®‰å…¨åº«å­˜é‡ï¼ˆä½æ–¼æ­¤æ•¸é‡æœƒè­¦ç¤ºï¼‰ï¼š</label>
    <input type="number" id="itemSafeStock" value="5" min="0">
    <label>é€²è²¨æˆæœ¬ï¼ˆå…ƒï¼‰ï¼š</label>
    <input type="number" id="itemCost" value="0" min="0" step="0.1">
    <label>ä¾›æ‡‰å•†ï¼š</label>
    <input type="text" id="itemSupplier" placeholder="é¸å¡«">
    <div style="margin-top: 1em; display: flex; gap: 1em;">
      <button onclick="saveItem()" class="success">ğŸ’¾ ä¿å­˜</button>
      <button onclick="closeModal()">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<!-- é€²å‡ºè²¨ Modal -->
<div id="stockModal" class="modal">
  <div class="modal-content">
    <h3 id="stockModalTitle">åº«å­˜ç•°å‹•</h3>
    <input type="hidden" id="stockItemId">
    <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; margin-bottom: 1em;">
      <strong id="stockItemName"></strong><br>
      <span style="color: #7f8c8d;">ç›®å‰åº«å­˜ï¼š<span id="currentStock" style="font-size: 1.5em; font-weight: bold; color: #2c3e50;"></span> ä»¶</span>
    </div>
    <label>ç•°å‹•é¡å‹ï¼š</label>
    <select id="stockAction">
      <option value="in">é€²è²¨ï¼ˆå¢åŠ åº«å­˜ï¼‰</option>
      <option value="out">å‡ºè²¨ï¼ˆæ¸›å°‘åº«å­˜ï¼‰</option>
      <option value="adjust">ç›¤é»èª¿æ•´</option>
    </select>
    <label>æ•¸é‡ï¼š</label>
    <input type="number" id="stockQty" value="1" min="1">
    <label>å‚™è¨»ï¼š</label>
    <input type="text" id="stockNote" placeholder="ä¾‹å¦‚ï¼šè£œè²¨ã€éŠ·å”®ã€ç›¤æ">
    <div style="margin-top: 1em; display: flex; gap: 1em;">
      <button onclick="updateStock()" class="success">âœ… ç¢ºèªç•°å‹•</button>
      <button onclick="closeModal()">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<script>
let inventory = [];
let currentFilter = 'all';

window.onload = function() {
  loadInventory();
  updateStats();
  renderTable();
  
  document.getElementById('searchInput').addEventListener('input', renderTable);
};

function loadInventory() {
  try {
    if (window.inventoryData) {
      inventory = window.inventoryData;
    }
  } catch(e) {
    console.log('è¼‰å…¥åº«å­˜è³‡æ–™å¤±æ•—');
  }
}

function saveInventory() {
  try {
    window.inventoryData = inventory;
  } catch(e) {
    console.log('ä¿å­˜åº«å­˜è³‡æ–™å¤±æ•—');
  }
}

function showAddModal() {
  document.getElementById('modalTitle').textContent = 'æ–°å¢å•†å“';
  document.getElementById('itemId').value = '';
  document.getElementById('itemName').value = '';
  document.getElementById('itemBrand').value = 'EVO';
  document.getElementById('itemType').value = 'å…¨ç½©å¼';
  document.getElementById('itemStock').value = '0';
  document.getElementById('itemSafeStock').value = '5';
  document.getElementById('itemCost').value = '0';
  document.getElementById('itemSupplier').value = '';
  document.getElementById('itemModal').style.display = 'flex';
}

function showEditModal(id) {
  let item = inventory.find(i => i.id === id);
  if (!item) return;
  
  document.getElementById('modalTitle').textContent = 'ç·¨è¼¯å•†å“';
  document.getElementById('itemId').value = item.id;
  document.getElementById('itemName').value = item.name;
  document.getElementById('itemBrand').value = item.brand;
  document.getElementById('itemType').value = item.type;
  document.getElementById('itemStock').value = item.stock;
  document.getElementById('itemSafeStock').value = item.safeStock;
  document.getElementById('itemCost').value = item.cost;
  document.getElementById('itemSupplier').value = item.supplier || '';
  document.getElementById('itemModal').style.display = 'flex';
}

function saveItem() {
  let id = document.getElementById('itemId').value;
  let item = {
    id: id || Date.now().toString(),
    name: document.getElementById('itemName').value.trim(),
    brand: document.getElementById('itemBrand').value,
    type: document.getElementById('itemType').value,
    stock: parseInt(document.getElementById('itemStock').value) || 0,
    safeStock: parseInt(document.getElementById('itemSafeStock').value) || 5,
    cost: parseFloat(document.getElementById('itemCost').value) || 0,
    supplier: document.getElementById('itemSupplier').value.trim(),
    createdAt: id ? inventory.find(i => i.id === id).createdAt : new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };
  
  if (!item.name) {
    alert('è«‹è¼¸å…¥å•†å“åç¨±ï¼');
    return;
  }
  
  if (id) {
    let index = inventory.findIndex(i => i.id === id);
    inventory[index] = item;
  } else {
    inventory.push(item);
  }
  
  saveInventory();
  updateStats();
  renderTable();
  closeModal();
  alert('âœ… ä¿å­˜æˆåŠŸï¼');
}

function showStockModal(id) {
  let item = inventory.find(i => i.id === id);
  if (!item) return;
  
  document.getElementById('stockItemId').value = id;
  document.getElementById('stockItemName').textContent = `${item.brand} ${item.name}`;
  document.getElementById('currentStock').textContent = item.stock;
  document.getElementById('stockAction').value = 'in';
  document.getElementById('stockQty').value = '1';
  document.getElementById('stockNote').value = '';
  document.getElementById('stockModal').style.display = 'flex';
}

function updateStock() {
  let id = document.getElementById('stockItemId').value;
  let action = document.getElementById('stockAction').value;
  let qty = parseInt(document.getElementById('stockQty').value) || 0;
  let note = document.getElementById('stockNote').value.trim();
  
  if (qty <= 0) {
    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸é‡ï¼');
    return;
  }
  
  let item = inventory.find(i => i.id === id);
  if (!item) return;
  
  let oldStock = item.stock;
  
  if (action === 'in') {
    item.stock += qty;
  } else if (action === 'out') {
    if (item.stock < qty) {
      if (!confirm(`åº«å­˜ä¸è¶³ï¼ç›®å‰åªæœ‰ ${item.stock} ä»¶ï¼Œç¢ºå®šè¦å‡ºè²¨ ${qty} ä»¶å—ï¼Ÿ`)) {
        return;
      }
    }
    item.stock -= qty;
    if (item.stock < 0) item.stock = 0;
  } else if (action === 'adjust') {
    item.stock = qty;
  }
  
  item.updatedAt = new Date().toISOString();
  
  saveInventory();
  updateStats();
  renderTable();
  closeModal();
  
  let actionText = action === 'in' ? 'é€²è²¨' : (action === 'out' ? 'å‡ºè²¨' : 'èª¿æ•´');
  alert(`âœ… åº«å­˜ç•°å‹•æˆåŠŸï¼\n\n${actionText}ï¼š${qty} ä»¶\nåŸåº«å­˜ï¼š${oldStock} ä»¶\næ–°åº«å­˜ï¼š${item.stock} ä»¶\n${note ? 'å‚™è¨»ï¼š' + note : ''}`);
}

function deleteItem(id) {
  let item = inventory.find(i => i.id === id);
  if (!item) return;
  
  if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${item.brand} ${item.name}ã€å—ï¼Ÿ\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) {
    return;
  }
  
  inventory = inventory.filter(i => i.id !== id);
  saveInventory();
  updateStats();
  renderTable();
  alert('âœ… å·²åˆªé™¤');
}

function updateStats() {
  let totalItems = inventory.length;
  let totalStock = inventory.reduce((sum, item) => sum + item.stock, 0);
  let totalValue = inventory.reduce((sum, item) => sum + (item.stock * item.cost), 0);
  let lowStockCount = inventory.filter(item => item.stock <= item.safeStock).length;
  
  document.getElementById('totalItems').textContent = totalItems;
  document.getElementById('totalStock').textContent = totalStock;
  document.getElementById('totalValue').textContent = '$' + totalValue.toFixed(0);
  document.getElementById('lowStockCount').textContent = lowStockCount;
}

function filterBy(type) {
  currentFilter = type;
  document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  renderTable();
}

function renderTable() {
  let searchTerm = document.getElementById('searchInput').value.toLowerCase();
  let filtered = inventory.filter(item => {
    let matchSearch = item.name.toLowerCase().includes(searchTerm) ||
                     item.brand.toLowerCase().includes(searchTerm) ||
                     item.type.toLowerCase().includes(searchTerm);
    
    if (!matchSearch) return false;
    
    if (currentFilter === 'all') return true;
    if (currentFilter === 'helmet') return item.type.includes('å®‰å…¨å¸½');
    if (currentFilter === 'accessory') return item.type.includes('é…ä»¶') || item.type.includes('é¡ç‰‡') || item.type.includes('å…§è¥¯');
    if (currentFilter === 'low') return item.stock <= item.safeStock && item.stock > 0;
    if (currentFilter === 'critical') return item.stock === 0;
    
    return true;
  });
  
  let html = '';
  if (filtered.length === 0) {
    html = '<tr><td colspan="9" style="text-align: center; color: #7f8c8d; padding: 2em;">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å•†å“</td></tr>';
  } else {
    filtered.forEach(item => {
      let stockStatus = '';
      let stockClass = '';
      if (item.stock === 0) {
        stockStatus = 'ç¼ºè²¨';
        stockClass = 'stock-critical';
      } else if (item.stock <= item.safeStock) {
        stockStatus = 'ä½åº«å­˜';
        stockClass = 'stock-low';
      } else {
        stockStatus = 'å……è¶³';
        stockClass = 'stock-good';
      }
      
      let stockValue = (item.stock * item.cost).toFixed(0);
      
      html += `
        <tr>
          <td><strong>${item.name}</strong></td>
          <td>${item.brand}</td>
          <td>${item.type}</td>
          <td><strong style="font-size: 1.2em;">${item.stock}</strong></td>
          <td>${item.safeStock}</td>
          <td>$${item.cost}</td>
          <td>$${stockValue}</td>
          <td><span class="stock-level ${stockClass}">${stockStatus}</span></td>
          <td>
            <button onclick="showStockModal('${item.id}')" class="success" style="padding: 6px 10px; font-size: 0.85em; margin: 2px;">ğŸ“¦ é€²å‡ºè²¨</button>
            <button onclick="showEditModal('${item.id}')" style="padding: 6px 10px; font-size: 0.85em; margin: 2px;">âœï¸</button>
            <button onclick="deleteItem('${item.id}')" class="danger" style="padding: 6px 10px; font-size: 0.85em; margin: 2px;">ğŸ—‘ï¸</button>
          </td>
        </tr>
      `;
    });
  }
  
  document.getElementById('inventoryTable').innerHTML = html;
}

function showStockAlert() {
  let lowStock = inventory.filter(item => item.stock <= item.safeStock);
  
  if (lowStock.length === 0) {
    alert('âœ… å¤ªæ£’äº†ï¼ç›®å‰æ‰€æœ‰å•†å“åº«å­˜éƒ½å¾ˆå……è¶³ï¼');
    return;
  }
  
  let message = `ğŸ”” è£œè²¨æé†’ï¼ˆ${lowStock.length} é …å•†å“éœ€è¦è£œè²¨ï¼‰\n\n`;
  lowStock.forEach(item => {
    let diff = item.safeStock - item.stock;
    message += `${item.stock === 0 ? 'ğŸš¨' : 'âš ï¸'} ${item.brand} ${item.name}\n`;
    message += `   ç›®å‰åº«å­˜ï¼š${item.stock} ä»¶\n`;
    message += `   å®‰å…¨åº«å­˜ï¼š${item.safeStock} ä»¶\n`;
    message += `   å»ºè­°è£œè²¨ï¼š${diff > 0 ? diff : item.safeStock} ä»¶\n\n`;
  });
  
  alert(message);
}

function exportData() {
  if (inventory.length === 0) {
    alert('ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡ºï¼');
    return;
  }
  
  let csv = 'å‹è™Ÿ,å“ç‰Œ,é¡å‹,åº«å­˜é‡,å®‰å…¨åº«å­˜,é€²è²¨æˆæœ¬,åº«å­˜å€¼,ä¾›æ‡‰å•†\n';
  inventory.forEach(item => {
    let stockValue = (item.stock * item.cost).toFixed(2);
    csv += `"${item.name}","${item.brand}","${item.type}",${item.stock},${item.safeStock},${item.cost},${stockValue},"${item.supplier || ''}"\n`;
  });
  
  let blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
  let link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'åº«å­˜å ±è¡¨_' + new Date().toLocaleDateString('zh-TW') + '.csv';
  link.click();
  
  alert('âœ… åº«å­˜å ±è¡¨å·²åŒ¯å‡ºï¼');
}

function closeModal() {
  document.getElementById('itemModal').style.display = 'none';
  document.getElementById('stockModal').style.display = 'none';
}

document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
});
</script>
</body>
</html>