<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è¦çš®æ©Ÿè»Šå®‰å…¨å¸½è¨‚åƒ¹ç³»çµ± Pro</title>
<style>
* { box-sizing: border-box; }
body { 
  font-family: "å¾®è»Ÿæ­£é»‘é«”", "Segoe UI", Arial, sans-serif; 
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  margin: 0;
  padding: 20px;
}
.container { 
  max-width: 1400px; 
  margin: 0 auto; 
  background: #fff; 
  padding: 2em; 
  border-radius: 20px; 
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2em;
  flex-wrap: wrap;
  gap: 1em;
  padding-bottom: 1em;
  border-bottom: 3px solid #f39c12;
}
h2 { 
  color: #2c3e50; 
  margin: 0;
  font-size: 1.8em;
}
.brand-tag {
  display: inline-block;
  padding: 4px 12px;
  background: linear-gradient(135deg, #f39c12, #e67e22);
  color: white;
  border-radius: 20px;
  font-size: 0.9em;
  font-weight: bold;
  margin-left: 10px;
}
.btn-group {
  display: flex;
  gap: 0.5em;
  flex-wrap: wrap;
}
button { 
  background: #3498db; 
  color: #fff; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 8px; 
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 14px;
}
button:hover { 
  background: #2980b9; 
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
}
button.secondary { background: #95a5a6; }
button.secondary:hover { background: #7f8c8d; }
button.success { background: #27ae60; }
button.success:hover { background: #229954; }
button.danger { background: #e74c3c; }
button.danger:hover { background: #c0392b; }
button.warning { background: #f39c12; }
button.warning:hover { background: #e67e22; }

.templates {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1em;
  margin-bottom: 2em;
  padding: 1em;
  background: linear-gradient(135deg, #fff5e6, #ffe6cc);
  border-radius: 12px;
  border-left: 5px solid #f39c12;
}
.templates h3 {
  grid-column: 1 / -1;
  margin: 0 0 0.5em 0;
  color: #2c3e50;
}
.template-card {
  padding: 1em;
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: all 0.3s;
  border: 2px solid transparent;
  text-align: center;
}
.template-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 16px rgba(243, 156, 18, 0.3);
  border-color: #f39c12;
}
.template-card .icon {
  font-size: 2em;
  margin-bottom: 0.3em;
}
.template-card .name {
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 0.3em;
}
.template-card .price {
  font-size: 0.85em;
  color: #7f8c8d;
}

label { 
  display: block; 
  margin-top: 1em;
  color: #34495e;
  font-weight: 500;
}
input[type="number"], input[type="text"] { 
  padding: 8px; 
  border: 2px solid #ddd;
  border-radius: 6px;
  transition: border 0.3s;
}
input[type="number"]:focus, input[type="text"]:focus {
  outline: none;
  border-color: #f39c12;
}
input[type="number"] { width: 90px; }
input[type="text"] { width: 140px; }

table { 
  border-collapse: collapse; 
  width: 100%; 
  margin-top: 1em;
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
th { 
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  color: white;
  padding: 12px 8px;
  text-align: center;
  font-weight: 600;
  font-size: 0.9em;
}
td { 
  border: 1px solid #ecf0f1; 
  padding: 10px 8px; 
  text-align: center;
  font-size: 0.9em;
}
tr:hover { background: #f8f9fa; }

.combo-badge {
  display: inline-block;
  padding: 2px 8px;
  background: #e74c3c;
  color: white;
  border-radius: 10px;
  font-size: 0.75em;
  font-weight: bold;
  margin-left: 5px;
}

.profit-indicator {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.9em;
}
.profit-good { background: #d4edda; color: #155724; }
.profit-fair { background: #fff3cd; color: #856404; }
.profit-poor { background: #f8d7da; color: #721c24; }

.options { 
  display: flex;
  flex-wrap: wrap;
  gap: 1em;
  margin: 1.5em 0;
  padding: 1em;
  background: #f8f9fa;
  border-radius: 10px;
}
.options label { 
  margin: 0;
  display: flex;
  align-items: center;
  gap: 0.5em;
  cursor: pointer;
}
.options input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.result-section {
  margin-top: 2em;
  padding: 1.5em;
  background: linear-gradient(135deg, #1e3c7215 0%, #2a529815 100%);
  border-radius: 12px;
  border-left: 5px solid #1e3c72;
}
.result { 
  font-size: 1.3em; 
  color: #2c3e50;
  font-weight: bold;
  margin: 0.5em 0;
}
.suggested { 
  font-size: 1.5em; 
  color: #27ae60;
  font-weight: bold;
  margin: 0.5em 0;
}
.warning-text {
  color: #e74c3c;
  font-size: 1.1em;
  margin-top: 0.5em;
}

.competitor-analysis {
  margin-top: 2em;
  padding: 1.5em;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.competitor-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1em;
  margin: 0.5em 0;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #3498db;
}
.price-comparison {
  display: flex;
  gap: 2em;
  align-items: center;
}
.price-tag {
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: bold;
}
.price-tag.yours { background: #d4edda; color: #155724; }
.price-tag.competitor { background: #fff3cd; color: #856404; }
.price-tag.expensive { background: #f8d7da; color: #721c24; }

.combo-section {
  margin-top: 2em;
  padding: 1.5em;
  background: linear-gradient(135deg, #fff5e6, #ffe6cc);
  border-radius: 12px;
  border-left: 5px solid #f39c12;
}
.combo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1em;
  margin-top: 1em;
}
.combo-card {
  padding: 1.2em;
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  border-top: 4px solid #f39c12;
}
.combo-card h4 {
  margin-top: 0;
  color: #2c3e50;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.combo-savings {
  background: #27ae60;
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.85em;
}

.supplier-section {
  margin-top: 2em;
  padding: 1.5em;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.supplier-comparison {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1em;
  margin-top: 1em;
}
.supplier-card {
  padding: 1em;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #3498db;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  overflow-y: auto;
}
.modal-content {
  background: white;
  padding: 2em;
  border-radius: 15px;
  max-width: 600px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  margin: 2em;
}
.modal-content h3 {
  margin-top: 0;
  color: #2c3e50;
  border-bottom: 2px solid #f39c12;
  padding-bottom: 0.5em;
}

@media (max-width: 768px) {
  .container { padding: 1em; }
  table, th, td { font-size: 12px; padding: 6px 4px; }
  input[type="number"] { width: 70px; }
  input[type="text"] { width: 100px; }
  .header { flex-direction: column; align-items: stretch; }
  .btn-group { justify-content: center; }
  h2 { font-size: 1.4em; text-align: center; }
  .templates { grid-template-columns: 1fr; }
}

@media print {
  body { background: white; }
  .btn-group, button { display: none; }
  .container { box-shadow: none; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <h2>ğŸï¸ è¦çš®æ©Ÿè»Šå®‰å…¨å¸½è¨‚åƒ¹ç³»çµ±</h2>
      <span class="brand-tag">EVO</span>
      <span class="brand-tag">è¯æ³°</span>
    </div>
    <div class="btn-group">
      <button onclick="toggleQuickInput()" class="warning">âš¡ å¿«é€Ÿç«¶å“è¼¸å…¥</button>
      <button onclick="saveData()" class="success">ğŸ’¾ ä¿å­˜æ–¹æ¡ˆ</button>
      <button onclick="loadData()" class="warning">ğŸ“‚ è¼‰å…¥æ–¹æ¡ˆ</button>
      <button onclick="addCompetitor()" class="secondary">ğŸ” ç«¶å“è³‡æ–™åº«</button>
      <button onclick="window.print()" class="secondary">ğŸ–¨ï¸ åˆ—å°</button>
    </div>
  </div>

  <!-- å¿«é€Ÿç«¶å“è¼¸å…¥é¢æ¿ -->
  <div id="quickInputPanel" style="display: none; margin-bottom: 2em; padding: 1.5em; background: linear-gradient(135deg, #fff9e6, #fff3cc); border-radius: 12px; border-left: 5px solid #f39c12;">
    <h3 style="margin-top: 0; color: #2c3e50; display: flex; align-items: center; gap: 0.5em;">
      âš¡ å¿«é€Ÿç«¶å“è¼¸å…¥æ¨¡å¼
      <span style="font-size: 0.7em; background: #27ae60; color: white; padding: 4px 10px; border-radius: 15px;">è¶…å¿«é€Ÿï¼</span>
    </h3>
    <div style="background: white; padding: 1.5em; border-radius: 10px; margin-bottom: 1em;">
      <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1em; margin-bottom: 1em;">
        <div>
          <label style="margin: 0; font-weight: bold; color: #2c3e50;">æœå°‹é—œéµå­—ï¼ˆè¦çš®ï¼‰</label>
          <input type="text" id="quickSearchTerm" placeholder="ä¾‹å¦‚ï¼šEVO å…¨ç½©å®‰å…¨å¸½" style="width: 100%; padding: 10px; font-size: 1.1em; border: 2px solid #f39c12; border-radius: 8px;">
          <small style="color: #7f8c8d;">ğŸ’¡ è¼¸å…¥å¾ŒæŒ‰ Enter æˆ–é»æ“Šå³å´æŒ‰éˆ•é–‹å•Ÿè¦çš®æœå°‹</small>
        </div>
        <div>
          <label style="margin: 0; font-weight: bold; color: #2c3e50;">ç›®æ¨™å•†å“æ•¸</label>
          <input type="number" id="targetCount" value="10" min="1" max="30" style="width: 100%; padding: 10px; font-size: 1.1em;">
        </div>
        <div style="display: flex; align-items: flex-end;">
          <button onclick="openShopeeSearch()" style="width: 100%; padding: 12px; font-size: 1em; background: #ee4d2d;">
            ğŸ” é–‹å•Ÿè¦çš®æœå°‹
          </button>
        </div>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5em;">
      <!-- å·¦å´ï¼šè¼¸å…¥å€ -->
      <div style="background: white; padding: 1.5em; border-radius: 10px; border: 2px solid #3498db;">
        <h4 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 0.5em;">
          ğŸ“ ç«¶å“åƒ¹æ ¼è¨˜éŒ„
        </h4>
        <div id="quickPriceInputs">
          <div style="display: flex; gap: 0.5em; margin-bottom: 0.8em; align-items: center;">
            <input type="number" class="quick-price-input" placeholder="åƒ¹æ ¼" style="flex: 1; padding: 8px; font-size: 1em; border: 2px solid #ddd; border-radius: 6px;">
            <button onclick="addQuickPrice()" class="success" style="padding: 8px 15px; font-size: 0.9em;">â•</button>
          </div>
        </div>
        <div style="margin-top: 1em; padding: 1em; background: #e8f4f8; border-radius: 8px;">
          <strong style="color: #2c3e50;">ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š</strong>
          <ol style="margin: 0.5em 0; padding-left: 1.5em; font-size: 0.9em; color: #34495e;">
            <li>åœ¨è¦çš®æ‰¾åˆ°å•†å“åƒ¹æ ¼å¾Œï¼Œç›´æ¥è¼¸å…¥</li>
            <li>æŒ‰ Enter æˆ–é» â• å¿«é€Ÿæ–°å¢ä¸‹ä¸€ç­†</li>
            <li>é‡è¤‡å‹•ä½œï¼Œè¨˜éŒ„ 5-10 å€‹ç«¶å“</li>
            <li>ç³»çµ±è‡ªå‹•è¨ˆç®—å¹³å‡ã€æœ€é«˜ã€æœ€ä½åƒ¹</li>
          </ol>
        </div>
      </div>

      <!-- å³å´ï¼šåˆ†æçµæœ -->
      <div style="background: white; padding: 1.5em; border-radius: 10px; border: 2px solid #27ae60;">
        <h4 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #27ae60; padding-bottom: 0.5em;">
          ğŸ“Š å³æ™‚å¸‚å ´åˆ†æ
        </h4>
        <div id="quickAnalysis">
          <div style="text-align: center; color: #7f8c8d; padding: 2em;">
            <div style="font-size: 3em; margin-bottom: 0.3em;">ğŸ“ˆ</div>
            è¼¸å…¥ç«¶å“åƒ¹æ ¼å¾Œ<br>å³æ™‚é¡¯ç¤ºå¸‚å ´åˆ†æ
          </div>
        </div>
        <button onclick="applyQuickAverage()" class="success" style="width: 100%; padding: 12px; font-size: 1.1em; margin-top: 1em;" id="applyBtn" disabled>
          âœ… å¥—ç”¨å¹³å‡åƒ¹åˆ°å•†å“è¡¨æ ¼
        </button>
      </div>
    </div>

    <div style="margin-top: 1em; display: flex; gap: 1em;">
      <button onclick="clearQuickInput()" class="secondary" style="flex: 1;">ğŸ—‘ï¸ æ¸…ç©ºè¨˜éŒ„</button>
      <button onclick="saveQuickData()" class="warning" style="flex: 1;">ğŸ’¾ ä¿å­˜æ­¤æ¬¡èª¿æŸ¥</button>
      <button onclick="toggleQuickInput()" class="secondary" style="flex: 1;">âœ–ï¸ é—œé–‰é¢æ¿</button>
    </div>
  </div>

  <div class="templates">
    <h3>âš¡ å¿«é€Ÿå¥—ç”¨å•†å“æ¨¡æ¿</h3>
    <div class="template-card" onclick="applyTemplate('full-face')">
      <div class="icon">ğŸª–</div>
      <div class="name">å…¨ç½©å¼å®‰å…¨å¸½</div>
      <div class="price">å»ºè­°å”®åƒ¹ 1200-3000</div>
    </div>
    <div class="template-card" onclick="applyTemplate('half-face')">
      <div class="icon">ğŸ½</div>
      <div class="name">åŠç½©å¼å®‰å…¨å¸½</div>
      <div class="price">å»ºè­°å”®åƒ¹ 600-1500</div>
    </div>
    <div class="template-card" onclick="applyTemplate('3-4-face')">
      <div class="icon">ğŸï¸</div>
      <div class="name">å››åˆ†ä¹‹ä¸‰</div>
      <div class="price">å»ºè­°å”®åƒ¹ 800-2000</div>
    </div>
    <div class="template-card" onclick="applyTemplate('kids')">
      <div class="icon">ğŸ‘¶</div>
      <div class="name">å…’ç«¥å®‰å…¨å¸½</div>
      <div class="price">å»ºè­°å”®åƒ¹ 300-800</div>
    </div>
    <div class="template-card" onclick="applyTemplate('lens')">
      <div class="icon">ğŸ•¶ï¸</div>
      <div class="name">é¡ç‰‡é…ä»¶</div>
      <div class="price">å¹³å‡æˆæœ¬ 28-55</div>
    </div>
    <div class="template-card" onclick="applyTemplate('liner')">
      <div class="icon">ğŸ§½</div>
      <div class="name">å…§è¥¯é…ä»¶</div>
      <div class="price">å¹³å‡æˆæœ¬ 31-42</div>
    </div>
  </div>

  <form id="goodsForm">
    <table>
      <thead>
        <tr>
          <th style="width: 15%;">å“å/å‹è™Ÿ</th>
          <th style="width: 8%;">å“ç‰Œ</th>
          <th style="width: 10%;">é€²è²¨æˆæœ¬</th>
          <th style="width: 6%;">æ•¸é‡</th>
          <th style="width: 8%;">åŒ…æè²»</th>
          <th style="width: 8%;">è™•ç†æ™‚é–“</th>
          <th style="width: 10%;">ç«¶å“å‡åƒ¹</th>
          <th style="width: 8%;">æˆæœ¬å°è¨ˆ</th>
          <th style="width: 6%;">çµ„åˆ</th>
          <th style="width: 11%;">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="goodsBody">
        <tr>
          <td><input type="text" name="name[]" placeholder="EVO 1200"></td>
          <td>
            <select name="brand[]" style="width: 80px; padding: 6px;">
              <option value="EVO">EVO</option>
              <option value="è¯æ³°">è¯æ³°</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </td>
          <td><input type="number" name="price[]" value="0" min="0" step="0.1"></td>
          <td><input type="number" name="qty[]" value="1" min="1"></td>
          <td><input type="number" name="pack[]" value="65" min="0" step="0.1"></td>
          <td><input type="number" name="labor[]" value="5" min="0" step="0.1"></td>
          <td><input type="number" name="competitor[]" value="0" min="0" placeholder="é¸å¡«"></td>
          <td class="subtotal"></td>
          <td><input type="checkbox" name="combo[]" title="å‹¾é¸è¡¨ç¤ºç‚ºçµ„åˆå•†å“"></td>
          <td>
            <button type="button" onclick="copyRow(this)" class="secondary" style="padding: 6px 8px; font-size: 11px;">ğŸ“‹</button>
            <button type="button" onclick="removeRow(this)" class="danger" style="padding: 6px 8px; font-size: 11px;">ğŸ—‘ï¸</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button type="button" onclick="addRow()">â• æ–°å¢å•†å“</button>
    <button type="button" onclick="calculateCombo()" class="warning">ğŸ è¨ˆç®—çµ„åˆå„ªæƒ </button>
  </form>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1em; margin-top: 1.5em;">
    <label>é‹è²»ï¼ˆå…ƒï¼‰<input type="number" id="shipping" value="60" min="0" title="åƒåŠ è¦çš®å…é‹æ´»å‹•ä¸€èˆ¬è¦ç¯„å…§å°ºå¯¸"></label>
    <label>äººäº‹æ™‚è–ªï¼ˆå…ƒ/å°æ™‚ï¼‰<input type="number" id="laborWage" value="200" min="1"></label>
    <label>å»£å‘Šæˆæœ¬ï¼ˆå…ƒ/å–®ï¼‰<input type="number" id="adCost" value="10" min="0" step="0.1"></label>
    <label>ç›®æ¨™åˆ©æ½¤ç‡ï¼ˆ%ï¼‰<input type="number" id="targetProfit" value="15" min="1" max="95"></label>
  </div>

  <div class="options">
    <strong style="width: 100%; color: #2c3e50;">ğŸ¯ è¦çš®è²»ç”¨é¸é …</strong>
    <label><input type="checkbox" id="promotion"> è¦çš®æ´»å‹•ï¼ˆé›™11/ç‰¹è³£ï¼‰</label>
    <label><input type="checkbox" id="freeShipping" checked> åƒåŠ å…é‹æ´»å‹•</label>
    <label><input type="checkbox" id="preorder"> é è³¼å•†å“</label>
    <label><input type="checkbox" id="coin"> è¦å¹£/å›é¥‹æ´»å‹•</label>
    <label><input type="checkbox" id="tax" checked> éœ€é–‹ç™¼ç¥¨æˆ–ç‡Ÿæ¥­ç¨…</label>
  </div>

  <div class="result-section">
    <div class="result" id="calcNet">ç¸½æˆæœ¬ï¼š-- å…ƒï½œä¼°ç®—æ¯›åˆ©ï¼š-- å…ƒ</div>
    <div class="suggested" id="calcSuggest">å»ºè­°æœ€ä½å”®åƒ¹ï¼š-- å…ƒ</div>
    <div id="warningText"></div>
  </div>

  <div class="competitor-analysis" id="competitorSection" style="display: none;">
    <h3 style="color: #2c3e50; margin-top: 0;">ğŸ“Š ç«¶å“åƒ¹æ ¼åˆ†æ</h3>
    <div id="competitorList"></div>
  </div>

  <div class="combo-section" id="comboSection" style="display: none;">
    <h3 style="color: #2c3e50; margin-top: 0;">ğŸ çµ„åˆå„ªæƒ æ–¹æ¡ˆå»ºè­°</h3>
    <div class="combo-grid" id="comboGrid"></div>
  </div>

  <div class="supplier-section">
    <h3 style="color: #2c3e50; margin-top: 0;">ğŸ“¦ ä¾›æ‡‰å•†æˆæœ¬åˆ†æ</h3>
    <button onclick="addSupplier()" class="success" style="margin-bottom: 1em;">â• æ–°å¢ä¾›æ‡‰å•†æ¯”è¼ƒ</button>
    <div class="supplier-comparison" id="supplierList">
      <p style="color: #7f8c8d;">é»æ“Šã€Œæ–°å¢ä¾›æ‡‰å•†æ¯”è¼ƒã€é–‹å§‹è¨˜éŒ„ä¸åŒä¾›æ‡‰å•†çš„å ±åƒ¹</p>
    </div>
  </div>

  <div style="margin-top: 2em; padding: 1em; background: #e8f4f8; border-radius: 10px; border-left: 4px solid #3498db;">
    <strong>ğŸ’¡ å®‰å…¨å¸½æ¥­è€…å°ˆç”¨æç¤ºï¼š</strong>
    <ul style="margin: 0.5em 0;">
      <li><strong>åŒ…æè²»å»ºè­°</strong>ï¼šå…¨ç½©å¸½ 65-80å…ƒï¼ˆå¤§ç®±+æ°£æ³¡ï¼‰ã€åŠç½©å¸½ 45-60å…ƒã€é…ä»¶ 15-25å…ƒ</li>
      <li><strong>ç›®æ¨™åˆ©æ½¤</strong>ï¼šå®‰å…¨å¸½æ¥­ç•Œå¹³å‡ 15-20%ï¼Œé…ä»¶å¯æé«˜è‡³ 25-30%</li>
      <li><strong>ç«¶å“æ¯”åƒ¹</strong>ï¼šå»ºè­°è‡³å°‘è¼¸å…¥ 3-5 å€‹ç«¶å“åƒ¹æ ¼ï¼Œç³»çµ±æœƒè‡ªå‹•åˆ†æç«¶çˆ­åŠ›</li>
      <li><strong>çµ„åˆéŠ·å”®</strong>ï¼šå‹¾é¸ã€Œçµ„åˆã€çš„å•†å“æœƒè¨ˆç®—å¥—è£å„ªæƒ æ–¹æ¡ˆ</li>
      <li><strong>å“ç‰Œå®šä½</strong>ï¼šEVO ä¸»æ‰“ CP å€¼ã€è¯æ³°å¼·èª¿å®‰å…¨èªè­‰ï¼Œå®šåƒ¹ç­–ç•¥å¯ä¸åŒ</li>
    </ul>
  </div>
</div>

<!-- æ¨¡æ…‹æ¡†ï¼šæ–°å¢ç«¶å“ -->
<div id="competitorModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ” æ–°å¢ç«¶å“è³‡æ–™</h3>
    <label>è³£å®¶åç¨±ï¼š<input type="text" id="compSellerName" placeholder="ä¾‹å¦‚ï¼šXXå®‰å…¨å¸½å°ˆè³£" style="width: 100%;"></label>
    <label>å•†å“å‹è™Ÿï¼š<input type="text" id="compProductName" placeholder="ä¾‹å¦‚ï¼šEVO 1200 å…¨ç½©" style="width: 100%;"></label>
    <label>å”®åƒ¹ï¼š<input type="number" id="compPrice" placeholder="ä¾‹å¦‚ï¼š1680" style="width: 100%;"></label>
    <label>æœˆéŠ·é‡ï¼š<input type="number" id="compSales" placeholder="é¸å¡«ï¼Œä¾‹å¦‚ï¼š85" style="width: 100%;"></label>
    <label>å‚™è¨»ï¼š<input type="text" id="compNotes" placeholder="ä¾‹å¦‚ï¼šé€é¡ç‰‡" style="width: 100%;"></label>
    <div style="margin-top: 1em; display: flex; gap: 1em;">
      <button onclick="saveCompetitor()" class="success">ç¢ºå®šæ–°å¢</button>
      <button onclick="closeModal('competitorModal')" class="secondary">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<!-- æ¨¡æ…‹æ¡†ï¼šæ–°å¢ä¾›æ‡‰å•† -->
<div id="supplierModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ“¦ æ–°å¢ä¾›æ‡‰å•†å ±åƒ¹</h3>
    <label>ä¾›æ‡‰å•†åç¨±ï¼š<input type="text" id="suppName" placeholder="ä¾‹å¦‚ï¼šXXè²¿æ˜“" style="width: 100%;"></label>
    <label>å•†å“å‹è™Ÿï¼š<input type="text" id="suppProduct" placeholder="ä¾‹å¦‚ï¼šEVO 1200" style="width: 100%;"></label>
    <label>é€²è²¨åƒ¹ï¼š<input type="number" id="suppPrice" placeholder="ä¾‹å¦‚ï¼š850" style="width: 100%;"></label>
    <label>æœ€ä½è¨‚è³¼é‡ï¼š<input type="number" id="suppMOQ" placeholder="ä¾‹å¦‚ï¼š10" style="width: 100%;"></label>
    <label>ä»˜æ¬¾æ¢ä»¶ï¼š<input type="text" id="suppPayment" placeholder="ä¾‹å¦‚ï¼šè²¨åˆ°ä»˜æ¬¾" style="width: 100%;"></label>
    <div style="margin-top: 1em; display: flex; gap: 1em;">
      <button onclick="saveSupplier()" class="success">ç¢ºå®šæ–°å¢</button>
      <button onclick="closeModal('supplierModal')" class="secondary">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<!-- æ¨¡æ…‹æ¡†ï¼šä¿å­˜/è¼‰å…¥æ–¹æ¡ˆ -->
<div id="saveModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ’¾ ä¿å­˜å®šåƒ¹æ–¹æ¡ˆ</h3>
    <label>æ–¹æ¡ˆåç¨±ï¼š<input type="text" id="saveName" placeholder="ä¾‹å¦‚ï¼š2025æ˜¥å­£å…¨ç½©å¸½çµ„" style="width: 100%;"></label>
    <div style="margin-top: 1em; display: flex; gap: 1em;">
      <button onclick="confirmSave()" class="success">ç¢ºå®šä¿å­˜</button>
      <button onclick="closeModal('saveModal')" class="secondary">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<div id="loadModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ“‚ è¼‰å…¥å®šåƒ¹æ–¹æ¡ˆ</h3>
    <div id="savedSchemes"></div>
    <button onclick="closeModal('loadModal')" class="secondary" style="margin-top: 1em;">é—œé–‰</button>
  </div>
</div>

<script>
// ========== å…¨å±€è®Šæ•¸ ==========
let competitors = [];
let suppliers = [];
let savedSchemes = {};

// ========== åˆå§‹åŒ– ==========
window.onload = function() {
  loadFromMemory();
  loadCompetitors();
  loadSuppliers();
  calcAll();
  attachEvents();
};

function attachEvents() {
  document.querySelectorAll('#goodsForm input, #goodsForm select, #shipping, #laborWage, #adCost, #targetProfit').forEach(el => {
    el.removeEventListener('input', handleInput);
    el.addEventListener('input', handleInput);
  });
  document.querySelectorAll('.options input[type="checkbox"]').forEach(el => {
    el.removeEventListener('change', handleInput);
    el.addEventListener('change', handleInput);
  });
}

function handleInput() {
  calcAll();
  saveToMemory();
}

// ========== æ¨¡æ¿æ‡‰ç”¨ ==========
const templates = {
  'full-face': { 
    name: 'EVO å…¨ç½©å¼', brand: 'EVO', price: 900, pack: 75, labor: 5, 
    competitor: 1680, desc: 'å…¨ç½©å®‰å…¨å¸½ï¼Œä¿è­·æ€§æœ€ä½³'
  },
  'half-face': { 
    name: 'EVO åŠç½©å¼', brand: 'EVO', price: 500, pack: 50, labor: 4, 
    competitor: 980, desc: 'åŠç½©å®‰å…¨å¸½ï¼Œè¼•ä¾¿èˆ’é©'
  },
  '3-4-face': { 
    name: 'EVO 3/4ç½©', brand: 'EVO', price: 650, pack: 60, labor: 4.5, 
    competitor: 1280, desc: 'å››åˆ†ä¹‹ä¸‰å®‰å…¨å¸½ï¼Œå¹³è¡¡æ¬¾'
  },
  'kids': { 
    name: 'è¯æ³°å…’ç«¥å¸½', brand: 'è¯æ³°', price: 350, pack: 40, labor: 4, 
    competitor: 680, desc: 'å…’ç«¥å°ˆç”¨ï¼Œå°é ­åœ'
  },
  'lens': { 
    name: 'é˜²éœ§é¡ç‰‡', brand: 'å…¶ä»–', price: 42, pack: 12, labor: 2, 
    competitor: 120, desc: 'é€šç”¨é¡ç‰‡é…ä»¶'
  },
  'liner': { 
    name: 'æ›¿æ›å…§è¥¯', brand: 'å…¶ä»–', price: 33, pack: 10, labor: 2, 
    competitor: 90, desc: 'å¯æ°´æ´—å…§è¥¯'
  }
};

function applyTemplate(type) {
  let t = templates[type];
  if (!t) return;
  
  addRow();
  let rows = document.querySelectorAll("#goodsBody tr");
  let lastRow = rows[rows.length - 1];
  
  lastRow.querySelector('input[name="name[]"]').value = t.name;
  lastRow.querySelector('select[name="brand[]"]').value = t.brand;
  lastRow.querySelector('input[name="price[]"]').value = t.price;
  lastRow.querySelector('input[name="pack[]"]').value = t.pack;
  lastRow.querySelector('input[name="labor[]"]').value = t.labor;
  lastRow.querySelector('input[name="competitor[]"]').value = t.competitor;
  
  calcAll();
}

// ========== è¡Œæ“ä½œ ==========
function addRow() {
  let row = `<tr>
    <td><input type="text" name="name[]" placeholder="å•†å“å‹è™Ÿ"></td>
    <td>
      <select name="brand[]" style="width: 80px; padding: 6px;">
        <option value="EVO">EVO</option>
        <option value="è¯æ³°">è¯æ³°</option>
        <option value="å…¶ä»–">å…¶ä»–</option>
      </select>
    </td>
    <td><input type="number" name="price[]" value="0" min="0" step="0.1"></td>
    <td><input type="number" name="qty[]" value="1" min="1"></td>
    <td><input type="number" name="pack[]" value="65" min="0" step="0.1"></td>
    <td><input type="number" name="labor[]" value="5" min="0" step="0.1"></td>
    <td><input type="number" name="competitor[]" value="0" min="0" placeholder="é¸å¡«"></td>
    <td class="subtotal"></td>
    <td><input type="checkbox" name="combo[]" title="å‹¾é¸è¡¨ç¤ºç‚ºçµ„åˆå•†å“"></td>
    <td>
      <button type="button" onclick="copyRow(this)" class="secondary" style="padding: 6px 8px; font-size: 11px;">ğŸ“‹</button>
      <button type="button" onclick="removeRow(this)" class="danger" style="padding: 6px 8px; font-size: 11px;">ğŸ—‘ï¸</button>
    </td>
  </tr>`;
  document.getElementById("goodsBody").insertAdjacentHTML('beforeend', row);
  attachEvents();
  calcAll();
}

function removeRow(btn) {
  if (document.querySelectorAll("#goodsBody tr").length > 1) {
    btn.closest('tr').remove();
    calcAll();
  } else {
    alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹å•†å“ï¼');
  }
}

function copyRow(btn) {
  let row = btn.closest('tr');
  let clone = row.cloneNode(true);
  row.parentNode.insertBefore(clone, row.nextSibling);
  attachEvents();
  calcAll();
}

// ========== æ ¸å¿ƒè¨ˆç®— ==========
function shopeeNet(price, shipping, options) {
  let feeRate = options.promotion ? 0.075 : 0.055;
  let flowRate = 0.02;
  let freeShipRate = options.freeShipping ? 0.07 : 0;
  let preorderRate = options.preorder ? 0.03 : 0;
  let coinRate = options.coin ? 0.03 : 0;
  let taxRate = options.tax ? 0.05 : 0.01;
  
  let fee = price * feeRate;
  let flow = (price + shipping) * flowRate;
  let freeShip = price * freeShipRate;
  let preorder = price * preorderRate;
  let coin = price * coinRate;
  let tax = price * taxRate;
  
  let totalFees = fee + flow + freeShip + preorder + coin + tax;
  let net = price - totalFees;
  return net < 0 ? 0 : net;
}

function reversePrice(targetNet, shipping, options) {
  let price = targetNet;
  let net = 0;
  for(let i = 0; i < 5000; i++) {
    net = shopeeNet(price, shipping, options);
    if(net >= targetNet) return Math.ceil(price);
    price += 1;
  }
  return 0;
}

function calcAll() {
  let laborWage = parseFloat(document.getElementById("laborWage").value) || 200;
  let adCost = parseFloat(document.getElementById("adCost").value) || 0;
  
  let names = Array.from(document.getElementsByName("name[]")).map(el => el.value || "æœªå‘½å");
  let brands = Array.from(document.getElementsByName("brand[]")).map(el => el.value);
  let prices = Array.from(document.getElementsByName("price[]")).map(el => parseFloat(el.value) || 0);
  let qtys = Array.from(document.getElementsByName("qty[]")).map(el => parseInt(el.value) || 0);
  let packCosts = Array.from(document.getElementsByName("pack[]")).map(el => parseFloat(el.value) || 0);
  let laborMins = Array.from(document.getElementsByName("labor[]")).map(el => parseFloat(el.value) || 0);
  let competitors = Array.from(document.getElementsByName("competitor[]")).map(el => parseFloat(el.value) || 0);
  let combos = Array.from(document.getElementsByName("combo[]")).map(el => el.checked);
  
  let subtotals = prices.map((p, i) => 
    (p + packCosts[i] + (laborWage * laborMins[i] / 60)) * qtys[i]
  );
  
  let rows = document.querySelectorAll("#goodsBody tr");
  subtotals.forEach((val, i) => { 
    rows[i].querySelector(".subtotal").innerText = val.toFixed(2) + " å…ƒ"; 
  });
  
  let totalCost = subtotals.reduce((a, b) => a + b, 0) + adCost;
  
  let shipping = parseFloat(document.getElementById("shipping").value) || 0;
  let options = {
    promotion: document.getElementById("promotion").checked,
    freeShipping: document.getElementById("freeShipping").checked,
    preorder: document.getElementById("preorder").checked,
    coin: document.getElementById("coin").checked,
    tax: document.getElementById("tax").checked
  };
  
  let profitRate = (parseFloat(document.getElementById("targetProfit").value) || 15) / 100;
  let targetNet = totalCost * (1 + profitRate);
  
  let suggestedPrice = reversePrice(targetNet, shipping, options);
  let estimateNet = shopeeNet(suggestedPrice, shipping, options);
  let profit = estimateNet - totalCost;
  let actualProfitRate = totalCost > 0 ? (profit / totalCost * 100) : 0;
  
  // ä¸»è¦çµæœ
  let profitClass = actualProfitRate >= 20 ? 'profit-good' : (actualProfitRate >= 10 ? 'profit-fair' : 'profit-poor');
  document.getElementById("calcNet").innerHTML = `
    ç¸½æˆæœ¬ï¼š<strong>${totalCost.toFixed(2)}</strong> å…ƒï½œ
    ä¼°ç®—æ¯›åˆ©ï¼š<strong>${profit.toFixed(2)}</strong> å…ƒï½œ
    <span class="profit-indicator ${profitClass}">åˆ©æ½¤ç‡ ${actualProfitRate.toFixed(1)}%</span>
  `;
  
  document.getElementById("calcSuggest").innerHTML = `
    ğŸ’° å»ºè­°æœ€ä½å”®åƒ¹ï¼š<strong style="font-size: 1.2em; color: #f39c12;">${suggestedPrice}</strong> å…ƒ
    <small style="font-size: 0.7em; color: #7f8c8d;">ï¼ˆé ä¼°æ·¨æ”¶ ${estimateNet.toFixed(2)} å…ƒï¼‰</small>
  `;
  
  // è­¦å‘Šè¨Šæ¯
  let warnings = [];
  if (actualProfitRate < 10) {
    warnings.push('âš ï¸ è­¦å‘Šï¼šåˆ©æ½¤ç‡éä½ï¼ˆ&lt;10%ï¼‰ï¼Œå»ºè­°èª¿æ•´å”®åƒ¹æˆ–é™ä½æˆæœ¬ï¼');
  }
  if (actualProfitRate < 15 && actualProfitRate >= 10) {
    warnings.push('ğŸ’¡ æç¤ºï¼šåˆ©æ½¤ç‡ç•¥ä½æ–¼æ¥­ç•Œå¹³å‡ï¼ˆ15%ï¼‰ï¼Œå¯è€ƒæ…®å¾®èª¿ã€‚');
  }
  if (suggestedPrice < totalCost) {
    warnings.push('ğŸš¨ åš´é‡è­¦å‘Šï¼šå»ºè­°å”®åƒ¹ä½æ–¼ç¸½æˆæœ¬ï¼Œå°‡æœƒè™§æï¼');
  }
  document.getElementById("warningText").innerHTML = warnings.length > 0 
    ? `<div class="warning-text">${warnings.join('<br>')}</div>` 
    : '';
  
  // ç«¶å“æ¯”è¼ƒåˆ†æ
  updateCompetitorAnalysis(names, brands, competitors, suggestedPrice);
}

// ========== ç«¶å“åˆ†æ ==========
function updateCompetitorAnalysis(names, brands, competitors, yourPrice) {
  let hasCompetitor = competitors.some(c => c > 0);
  if (!hasCompetitor) {
    document.getElementById('competitorSection').style.display = 'none';
    return;
  }
  
  document.getElementById('competitorSection').style.display = 'block';
  let html = '';
  
  competitors.forEach((comp, i) => {
    if (comp > 0) {
      let diff = yourPrice - comp;
      let diffPercent = ((diff / comp) * 100).toFixed(1);
      let status = '';
      let priceClass = '';
      
      if (Math.abs(diff) <= comp * 0.05) {
        status = 'åƒ¹æ ¼ç›¸ç•¶';
        priceClass = 'yours';
      } else if (diff < 0) {
        status = `ä¾¿å®œ ${Math.abs(diffPercent)}%`;
        priceClass = 'yours';
      } else if (diff > 0 && diff <= comp * 0.15) {
        status = `ç•¥è²´ ${diffPercent}%`;
        priceClass = 'competitor';
      } else {
        status = `åè²´ ${diffPercent}%`;
        priceClass = 'expensive';
      }
      
      html += `
        <div class="competitor-item">
          <div>
            <strong>${names[i]}</strong> <span style="color: #7f8c8d;">[${brands[i]}]</span>
          </div>
          <div class="price-comparison">
            <div>ç«¶å“å‡åƒ¹ï¼š<span style="font-weight: bold;">${comp}</span> å…ƒ</div>
            <div>â†’</div>
            <div>æ‚¨çš„å”®åƒ¹ï¼š<span class="price-tag ${priceClass}">${yourPrice} å…ƒ</span></div>
            <div style="font-weight: bold; color: ${priceClass === 'expensive' ? '#e74c3c' : '#27ae60'};">${status}</div>
          </div>
        </div>
      `;
    }
  });
  
  document.getElementById('competitorList').innerHTML = html;
}

// ========== çµ„åˆå„ªæƒ è¨ˆç®— ==========
function calculateCombo() {
  let names = Array.from(document.getElementsByName("name[]")).map(el => el.value || "æœªå‘½å");
  let prices = Array.from(document.getElementsByName("price[]")).map(el => parseFloat(el.value) || 0);
  let combos = Array.from(document.getElementsByName("combo[]")).map(el => el.checked);
  let packCosts = Array.from(document.getElementsByName("pack[]")).map(el => parseFloat(el.value) || 0);
  let laborMins = Array.from(document.getElementsByName("labor[]")).map(el => parseFloat(el.value) || 0);
  let laborWage = parseFloat(document.getElementById("laborWage").value) || 200;
  
  let comboItems = [];
  combos.forEach((isCombo, i) => {
    if (isCombo) {
      comboItems.push({
        name: names[i],
        cost: prices[i] + packCosts[i] + (laborWage * laborMins[i] / 60)
      });
    }
  });
  
  if (comboItems.length < 2) {
    alert('è«‹è‡³å°‘å‹¾é¸ 2 å€‹å•†å“ä½œç‚ºçµ„åˆï¼');
    return;
  }
  
  document.getElementById('comboSection').style.display = 'block';
  
  let shipping = parseFloat(document.getElementById("shipping").value) || 0;
  let options = {
    promotion: document.getElementById("promotion").checked,
    freeShipping: document.getElementById("freeShipping").checked,
    preorder: document.getElementById("preorder").checked,
    coin: document.getElementById("coin").checked,
    tax: document.getElementById("tax").checked
  };
  let profitRate = (parseFloat(document.getElementById("targetProfit").value) || 15) / 100;
  
  let html = '';
  
  // æ–¹æ¡ˆ1ï¼šæ¨™æº–çµ„åˆï¼ˆåŸåƒ¹ 15% åˆ©æ½¤ï¼‰
  let combo1Cost = comboItems.reduce((sum, item) => sum + item.cost, 0);
  let combo1Target = combo1Cost * (1 + profitRate);
  let combo1Price = reversePrice(combo1Target, shipping, options);
  let combo1Profit = shopeeNet(combo1Price, shipping, options) - combo1Cost;
  
  html += `
    <div class="combo-card">
      <h4>
        æ¨™æº–çµ„åˆ
        <span class="combo-savings">åˆ©æ½¤ ${profitRate * 100}%</span>
      </h4>
      <div style="color: #7f8c8d; margin-bottom: 0.5em;">
        ${comboItems.map(item => item.name).join(' + ')}
      </div>
      <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">
        å»ºè­°å”®åƒ¹ï¼š${combo1Price} å…ƒ
      </div>
      <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 0.3em;">
        æˆæœ¬ ${combo1Cost.toFixed(0)} å…ƒ â†’ æ¯›åˆ© ${combo1Profit.toFixed(0)} å…ƒ
      </div>
    </div>
  `;
  
  // æ–¹æ¡ˆ2ï¼šä¿ƒéŠ·çµ„åˆï¼ˆé™ä½åˆ©æ½¤æ›å–ç«¶çˆ­åŠ›ï¼‰
  let combo2Target = combo1Cost * (1 + profitRate * 0.7);
  let combo2Price = reversePrice(combo2Target, shipping, options);
  let combo2Profit = shopeeNet(combo2Price, shipping, options) - combo1Cost;
  let combo2Savings = combo1Price - combo2Price;
  
  html += `
    <div class="combo-card">
      <h4>
        ä¿ƒéŠ·çµ„åˆ
        <span class="combo-savings" style="background: #e74c3c;">çœ ${combo2Savings} å…ƒ</span>
      </h4>
      <div style="color: #7f8c8d; margin-bottom: 0.5em;">
        ${comboItems.map(item => item.name).join(' + ')}
      </div>
      <div style="font-size: 1.2em; font-weight: bold; color: #e74c3c;">
        å„ªæƒ åƒ¹ï¼š${combo2Price} å…ƒ
      </div>
      <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 0.3em;">
        æˆæœ¬ ${combo1Cost.toFixed(0)} å…ƒ â†’ æ¯›åˆ© ${combo2Profit.toFixed(0)} å…ƒï¼ˆåˆ©æ½¤ç‡ ${((combo2Profit / combo1Cost) * 100).toFixed(1)}%ï¼‰
      </div>
    </div>
  `;
  
  // æ–¹æ¡ˆ3ï¼šåŠ åƒ¹è³¼ï¼ˆä¸»å•†å“+é…ä»¶ï¼‰
  if (comboItems.length >= 2) {
    let mainItem = comboItems[0];
    let accessories = comboItems.slice(1);
    let accTotal = accessories.reduce((sum, item) => sum + item.cost, 0);
    let combo3Price = Math.round(accTotal * 1.3); // é…ä»¶åŠ åƒ¹è³¼åªè³º 30%
    
    html += `
      <div class="combo-card">
        <h4>
          åŠ åƒ¹è³¼æ–¹æ¡ˆ
          <span class="combo-savings" style="background: #9b59b6;">è¶…å€¼</span>
        </h4>
        <div style="color: #7f8c8d; margin-bottom: 0.5em;">
          ä¸»å•†å“ï¼š${mainItem.name}<br>
          åŠ è³¼ï¼š${accessories.map(item => item.name).join(' + ')}
        </div>
        <div style="font-size: 1.2em; font-weight: bold; color: #9b59b6;">
          åŠ åƒ¹ ${combo3Price} å…ƒå³å¯è³¼å¾—é…ä»¶
        </div>
        <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 0.3em;">
          é…ä»¶æˆæœ¬ ${accTotal.toFixed(0)} å…ƒ â†’ æ¯›åˆ© ${(combo3Price - accTotal).toFixed(0)} å…ƒ
        </div>
      </div>
    `;
  }
  
  document.getElementById('comboGrid').innerHTML = html;
  
  // æ»¾å‹•åˆ°çµ„åˆå€åŸŸ
  document.getElementById('comboSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// ========== å¿«é€Ÿç«¶å“è¼¸å…¥åŠŸèƒ½ ==========
let quickPrices = [];

function toggleQuickInput() {
  let panel = document.getElementById('quickInputPanel');
  if (panel.style.display === 'none') {
    panel.style.display = 'block';
    panel.scrollIntoView({ behavior: 'smooth' });
    document.getElementById('quickSearchTerm').focus();
  } else {
    panel.style.display = 'none';
  }
}

function openShopeeSearch() {
  let term = document.getElementById('quickSearchTerm').value.trim();
  if (!term) {
    alert('è«‹è¼¸å…¥æœå°‹é—œéµå­—ï¼');
    return;
  }
  let url = 'https://shopee.tw/search?keyword=' + encodeURIComponent(term);
  window.open(url, '_blank', 'width=1200,height=800');
  alert('âœ… å·²é–‹å•Ÿè¦çš®æœå°‹é é¢ï¼\n\nğŸ“ è«‹åœ¨æ–°è¦–çª—æŸ¥çœ‹å•†å“åƒ¹æ ¼ï¼Œç„¶å¾Œå›åˆ°æœ¬é é¢è¼¸å…¥åƒ¹æ ¼ã€‚\n\nğŸ’¡ å»ºè­°ï¼šå°‡å…©å€‹è¦–çª—ä¸¦æ’é¡¯ç¤ºï¼Œæ–¹ä¾¿å¿«é€Ÿè¼¸å…¥ã€‚');
}

function addQuickPrice() {
  let inputs = document.querySelectorAll('.quick-price-input');
  let lastInput = inputs[inputs.length - 1];
  let price = parseFloat(lastInput.value);
  
  if (!price || price <= 0) {
    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„åƒ¹æ ¼ï¼');
    return;
  }
  
  quickPrices.push(price);
  lastInput.value = '';
  lastInput.style.borderColor = '#27ae60';
  
  setTimeout(() => {
    lastInput.style.borderColor = '#ddd';
  }, 500);
  
  updateQuickAnalysis();
  lastInput.focus();
}

// æ”¯æ´ Enter éµå¿«é€Ÿæ–°å¢
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('quickInputPanel').addEventListener('keypress', function(e) {
    if (e.target.classList.contains('quick-price-input') && e.key === 'Enter') {
      e.preventDefault();
      addQuickPrice();
    }
  });
  
  document.getElementById('quickSearchTerm').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      openShopeeSearch();
    }
  });
});

function updateQuickAnalysis() {
  if (quickPrices.length === 0) {
    document.getElementById('applyBtn').disabled = true;
    return;
  }
  
  document.getElementById('applyBtn').disabled = false;
  
  let avg = quickPrices.reduce((a, b) => a + b, 0) / quickPrices.length;
  let max = Math.max(...quickPrices);
  let min = Math.min(...quickPrices);
  let sorted = [...quickPrices].sort((a, b) => a - b);
  let median = sorted.length % 2 === 0 
    ? (sorted[sorted.length / 2 - 1] + sorted[sorted.length / 2]) / 2 
    : sorted[Math.floor(sorted.length / 2)];
  
  let priceList = quickPrices.map((p, i) => 
    `<span style="display: inline-block; padding: 4px 10px; background: #ecf0f1; border-radius: 15px; margin: 3px;">${i + 1}. ${p}</span>`
  ).join('');
  
  let html = `
    <div style="margin-bottom: 1em;">
      <strong style="color: #2c3e50;">å·²è¨˜éŒ„ ${quickPrices.length} ç­†ç«¶å“åƒ¹æ ¼ï¼š</strong>
      <div style="margin-top: 0.5em;">${priceList}</div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em; margin-top: 1em;">
      <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 1em; border-radius: 10px; text-align: center;">
        <div style="font-size: 0.9em; opacity: 0.9;">å¹³å‡åƒ¹æ ¼</div>
        <div style="font-size: 2em; font-weight: bold; margin: 0.2em 0;">${Math.round(avg)}</div>
        <div style="font-size: 0.85em; opacity: 0.8;">å»ºè­°åƒè€ƒæ­¤åƒ¹æ ¼</div>
      </div>
      
      <div style="background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 1em; border-radius: 10px; text-align: center;">
        <div style="font-size: 0.9em; opacity: 0.9;">ä¸­ä½æ•¸</div>
        <div style="font-size: 2em; font-weight: bold; margin: 0.2em 0;">${Math.round(median)}</div>
        <div style="font-size: 0.85em; opacity: 0.8;">æ’é™¤æ¥µç«¯å€¼</div>
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em; margin-top: 1em;">
      <div style="padding: 0.8em; background: #fff3cd; border-radius: 8px; text-align: center;">
        <strong style="color: #856404;">æœ€é«˜åƒ¹ï¼š</strong>
        <span style="font-size: 1.3em; font-weight: bold; color: #856404;">${max}</span>
      </div>
      <div style="padding: 0.8em; background: #d4edda; border-radius: 8px; text-align: center;">
        <strong style="color: #155724;">æœ€ä½åƒ¹ï¼š</strong>
        <span style="font-size: 1.3em; font-weight: bold; color: #155724;">${min}</span>
      </div>
    </div>
    
    <div style="margin-top: 1em; padding: 1em; background: #e8f4f8; border-radius: 8px; border-left: 4px solid #3498db;">
      <strong style="color: #2c3e50;">ğŸ’¡ å®šåƒ¹å»ºè­°ï¼š</strong>
      <ul style="margin: 0.5em 0; padding-left: 1.5em; color: #34495e;">
        <li><strong>ä¿å®ˆç­–ç•¥ï¼š</strong>å®šåœ¨å¹³å‡åƒ¹ ${Math.round(avg)} å·¦å³</li>
        <li><strong>ç«¶çˆ­ç­–ç•¥ï¼š</strong>å®šåœ¨ ${Math.round(avg * 0.95)} - ${Math.round(avg * 0.98)} é–“</li>
        <li><strong>åƒ¹å€¼ç­–ç•¥ï¼š</strong>è‹¥å“è³ªæ›´å¥½ï¼Œå¯å®š ${Math.round(avg * 1.05)} - ${Math.round(max)}</li>
      </ul>
    </div>
  `;
  
  document.getElementById('quickAnalysis').innerHTML = html;
}

function applyQuickAverage() {
  if (quickPrices.length === 0) return;
  
  let avg = Math.round(quickPrices.reduce((a, b) => a + b, 0) / quickPrices.length);
  
  // æ‰¾åˆ°ç¬¬ä¸€å€‹ç©ºçš„ç«¶å“åƒ¹æ ¼æ¬„ä½æˆ–æœ€å¾Œä¸€è¡Œ
  let competitorInputs = document.getElementsByName("competitor[]");
  let applied = false;
  
  for (let i = 0; i < competitorInputs.length; i++) {
    if (!competitorInputs[i].value || competitorInputs[i].value == 0) {
      competitorInputs[i].value = avg;
      competitorInputs[i].style.background = '#d4edda';
      setTimeout(() => {
        competitorInputs[i].style.background = '';
      }, 2000);
      applied = true;
      break;
    }
  }
  
  if (!applied && competitorInputs.length > 0) {
    competitorInputs[competitorInputs.length - 1].value = avg;
  }
  
  calcAll();
  alert(`âœ… å·²å°‡ç«¶å“å¹³å‡åƒ¹ ${avg} å¥—ç”¨åˆ°å•†å“è¡¨æ ¼ï¼\n\nè¨˜éŒ„çš„ ${quickPrices.length} ç­†åƒ¹æ ¼å·²ä¿å­˜ï¼Œå¯ç¹¼çºŒè¼¸å…¥å…¶ä»–å•†å“çš„ç«¶å“åƒ¹æ ¼ã€‚`);
}

function clearQuickInput() {
  if (quickPrices.length > 0 && !confirm('ç¢ºå®šè¦æ¸…ç©ºç›®å‰è¨˜éŒ„çš„ ' + quickPrices.length + ' ç­†åƒ¹æ ¼å—ï¼Ÿ')) {
    return;
  }
  quickPrices = [];
  document.querySelector('.quick-price-input').value = '';
  document.getElementById('quickAnalysis').innerHTML = `
    <div style="text-align: center; color: #7f8c8d; padding: 2em;">
      <div style="font-size: 3em; margin-bottom: 0.3em;">ğŸ“ˆ</div>
      è¼¸å…¥ç«¶å“åƒ¹æ ¼å¾Œ<br>å³æ™‚é¡¯ç¤ºå¸‚å ´åˆ†æ
    </div>
  `;
  document.getElementById('applyBtn').disabled = true;
}

function saveQuickData() {
  if (quickPrices.length === 0) {
    alert('ç›®å‰æ²’æœ‰è¨˜éŒ„ä»»ä½•åƒ¹æ ¼ï¼');
    return;
  }
  
  let keyword = document.getElementById('quickSearchTerm').value.trim() || 'æœªå‘½åå•†å“';
  let avg = Math.round(quickPrices.reduce((a, b) => a + b, 0) / quickPrices.length);
  let date = new Date().toLocaleDateString('zh-TW');
  
  let record = {
    keyword: keyword,
    prices: [...quickPrices],
    average: avg,
    date: date,
    count: quickPrices.length
  };
  
  if (!window.priceRecords) {
    window.priceRecords = [];
  }
  window.priceRecords.push(record);
  
  alert(`âœ… å·²ä¿å­˜èª¿æŸ¥è¨˜éŒ„ï¼\n\nå•†å“ï¼š${keyword}\nè¨˜éŒ„ç­†æ•¸ï¼š${quickPrices.length}\nå¹³å‡åƒ¹æ ¼ï¼š${avg}\næ—¥æœŸï¼š${date}\n\næ­¤è¨˜éŒ„æœƒä¿ç•™åœ¨ç€è¦½å™¨ä¸­ï¼Œå¯éš¨æ™‚æŸ¥çœ‹æ­·å²ç´€éŒ„ã€‚`);
}

// ========== ç«¶å“ç®¡ç† ==========
function addCompetitor() {
  document.getElementById('competitorModal').style.display = 'flex';
  document.getElementById('compSellerName').value = '';
  document.getElementById('compProductName').value = '';
  document.getElementById('compPrice').value = '';
  document.getElementById('compSales').value = '';
  document.getElementById('compNotes').value = '';
}

function saveCompetitor() {
  let data = {
    seller: document.getElementById('compSellerName').value.trim(),
    product: document.getElementById('compProductName').value.trim(),
    price: parseFloat(document.getElementById('compPrice').value) || 0,
    sales: parseInt(document.getElementById('compSales').value) || 0,
    notes: document.getElementById('compNotes').value.trim(),
    date: new Date().toLocaleDateString('zh-TW')
  };
  
  if (!data.seller || !data.product || data.price <= 0) {
    alert('è«‹å¡«å¯«å®Œæ•´è³‡æ–™ï¼');
    return;
  }
  
  competitors.push(data);
  saveCompetitors();
  closeModal('competitorModal');
  alert('âœ… ç«¶å“è³‡æ–™å·²ä¿å­˜ï¼\n\næç¤ºï¼šæ‚¨å¯ä»¥åœ¨å•†å“è¡¨æ ¼çš„ã€Œç«¶å“å‡åƒ¹ã€æ¬„ä½è¼¸å…¥ ' + data.price + ' å…ƒé€²è¡Œæ¯”è¼ƒã€‚');
}

function saveCompetitors() {
  try {
    window.competitorsData = competitors;
  } catch(e) {
    console.log('ç„¡æ³•ä¿å­˜ç«¶å“è³‡æ–™');
  }
}

function loadCompetitors() {
  try {
    if (window.competitorsData) {
      competitors = window.competitorsData;
    }
  } catch(e) {
    console.log('ç„¡æ³•è¼‰å…¥ç«¶å“è³‡æ–™');
  }
}

// ========== ä¾›æ‡‰å•†ç®¡ç† ==========
function addSupplier() {
  document.getElementById('supplierModal').style.display = 'flex';
  document.getElementById('suppName').value = '';
  document.getElementById('suppProduct').value = '';
  document.getElementById('suppPrice').value = '';
  document.getElementById('suppMOQ').value = '';
  document.getElementById('suppPayment').value = '';
}

function saveSupplier() {
  let data = {
    name: document.getElementById('suppName').value.trim(),
    product: document.getElementById('suppProduct').value.trim(),
    price: parseFloat(document.getElementById('suppPrice').value) || 0,
    moq: parseInt(document.getElementById('suppMOQ').value) || 0,
    payment: document.getElementById('suppPayment').value.trim(),
    date: new Date().toLocaleDateString('zh-TW')
  };
  
  if (!data.name || !data.product || data.price <= 0) {
    alert('è«‹å¡«å¯«å®Œæ•´è³‡æ–™ï¼');
    return;
  }
  
  suppliers.push(data);
  saveSuppliers();
  displaySuppliers();
  closeModal('supplierModal');
  alert('âœ… ä¾›æ‡‰å•†è³‡æ–™å·²ä¿å­˜ï¼');
}

function displaySuppliers() {
  if (suppliers.length === 0) {
    document.getElementById('supplierList').innerHTML = '<p style="color: #7f8c8d;">é»æ“Šã€Œæ–°å¢ä¾›æ‡‰å•†æ¯”è¼ƒã€é–‹å§‹è¨˜éŒ„ä¸åŒä¾›æ‡‰å•†çš„å ±åƒ¹</p>';
    return;
  }
  
  // æŒ‰å•†å“åˆ†çµ„
  let grouped = {};
  suppliers.forEach(supp => {
    if (!grouped[supp.product]) {
      grouped[supp.product] = [];
    }
    grouped[supp.product].push(supp);
  });
  
  let html = '';
  for (let product in grouped) {
    let suppList = grouped[product];
    suppList.sort((a, b) => a.price - b.price);
    let cheapest = suppList[0];
    
    html += `<div class="supplier-card">
      <h4 style="margin-top: 0; color: #2c3e50;">${product}</h4>`;
    
    suppList.forEach((supp, idx) => {
      let badge = idx === 0 ? '<span style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 0.5em;">æœ€ä¾¿å®œ</span>' : '';
      html += `
        <div style="padding: 0.5em; background: ${idx === 0 ? '#d4edda' : '#fff'}; margin: 0.3em 0; border-radius: 5px;">
          <strong>${supp.name}</strong> ${badge}<br>
          <span style="font-size: 1.1em; color: #2c3e50; font-weight: bold;">${supp.price} å…ƒ</span>
          ${supp.moq > 0 ? `<span style="color: #7f8c8d;"> / æœ€ä½è¨‚è³¼ ${supp.moq} ä»¶</span>` : ''}
          ${supp.payment ? `<br><small style="color: #7f8c8d;">${supp.payment}</small>` : ''}
        </div>
      `;
    });
    
    html += `</div>`;
  }
  
  document.getElementById('supplierList').innerHTML = html;
}

function saveSuppliers() {
  try {
    window.suppliersData = suppliers;
    displaySuppliers();
  } catch(e) {
    console.log('ç„¡æ³•ä¿å­˜ä¾›æ‡‰å•†è³‡æ–™');
  }
}

function loadSuppliers() {
  try {
    if (window.suppliersData) {
      suppliers = window.suppliersData;
      displaySuppliers();
    }
  } catch(e) {
    console.log('ç„¡æ³•è¼‰å…¥ä¾›æ‡‰å•†è³‡æ–™');
  }
}

// ========== æ•¸æ“šæŒä¹…åŒ– ==========
function saveToMemory() {
  try {
    let data = {
      names: Array.from(document.getElementsByName("name[]")).map(el => el.value),
      brands: Array.from(document.getElementsByName("brand[]")).map(el => el.value),
      prices: Array.from(document.getElementsByName("price[]")).map(el => el.value),
      qtys: Array.from(document.getElementsByName("qty[]")).map(el => el.value),
      packs: Array.from(document.getElementsByName("pack[]")).map(el => el.value),
      labors: Array.from(document.getElementsByName("labor[]")).map(el => el.value),
      competitors: Array.from(document.getElementsByName("competitor[]")).map(el => el.value),
      combos: Array.from(document.getElementsByName("combo[]")).map(el => el.checked),
      shipping: document.getElementById("shipping").value,
      laborWage: document.getElementById("laborWage").value,
      adCost: document.getElementById("adCost").value,
      targetProfit: document.getElementById("targetProfit").value,
      promotion: document.getElementById("promotion").checked,
      freeShipping: document.getElementById("freeShipping").checked,
      preorder: document.getElementById("preorder").checked,
      coin: document.getElementById("coin").checked,
      tax: document.getElementById("tax").checked
    };
    window.currentData = data;
  } catch(e) {
    console.log('ç„¡æ³•ä¿å­˜æ•¸æ“š');
  }
}

function loadFromMemory() {
  try {
    if (!window.currentData) return;
    let data = window.currentData;
    
    document.getElementById("goodsBody").innerHTML = '';
    
    for (let i = 0; i < data.names.length; i++) {
      addRow();
    }
    
    let nameInputs = document.getElementsByName("name[]");
    let brandSelects = document.getElementsByName("brand[]");
    let priceInputs = document.getElementsByName("price[]");
    let qtyInputs = document.getElementsByName("qty[]");
    let packInputs = document.getElementsByName("pack[]");
    let laborInputs = document.getElementsByName("labor[]");
    let competitorInputs = document.getElementsByName("competitor[]");
    let comboCheckboxes = document.getElementsByName("combo[]");
    
    for (let i = 0; i < data.names.length; i++) {
      if (nameInputs[i]) nameInputs[i].value = data.names[i];
      if (brandSelects[i]) brandSelects[i].value = data.brands[i];
      if (priceInputs[i]) priceInputs[i].value = data.prices[i];
      if (qtyInputs[i]) qtyInputs[i].value = data.qtys[i];
      if (packInputs[i]) packInputs[i].value = data.packs[i];
      if (laborInputs[i]) laborInputs[i].value = data.labors[i];
      if (competitorInputs[i]) competitorInputs[i].value = data.competitors[i];
      if (comboCheckboxes[i]) comboCheckboxes[i].checked = data.combos[i];
    }
    
    document.getElementById("shipping").value = data.shipping;
    document.getElementById("laborWage").value = data.laborWage;
    document.getElementById("adCost").value = data.adCost;
    document.getElementById("targetProfit").value = data.targetProfit;
    document.getElementById("promotion").checked = data.promotion;
    document.getElementById("freeShipping").checked = data.freeShipping;
    document.getElementById("preorder").checked = data.preorder;
    document.getElementById("coin").checked = data.coin;
    document.getElementById("tax").checked = data.tax;
  } catch(e) {
    console.log('ç„¡æ³•è¼‰å…¥æ•¸æ“š');
  }
}

// ========== æ–¹æ¡ˆä¿å­˜/è¼‰å…¥ ==========
function saveData() {
  document.getElementById('saveModal').style.display = 'flex';
  document.getElementById('saveName').value = '';
  document.getElementById('saveName').focus();
}

function confirmSave() {
  let name = document.getElementById('saveName').value.trim();
  if (!name) {
    alert('è«‹è¼¸å…¥æ–¹æ¡ˆåç¨±ï¼');
    return;
  }
  
  saveToMemory();
  if (window.currentData) {
    if (!savedSchemes) savedSchemes = {};
    savedSchemes[name] = {
      data: window.currentData,
      time: new Date().toLocaleString('zh-TW')
    };
    window.savedSchemes = savedSchemes;
    alert('âœ… æ–¹æ¡ˆã€Œ' + name + 'ã€å·²ä¿å­˜ï¼');
    closeModal('saveModal');
  }
}

function loadData() {
  loadSchemes();
  document.getElementById('loadModal').style.display = 'flex';
  displaySchemes();
}

function loadSchemes() {
  try {
    if (window.savedSchemes) {
      savedSchemes = window.savedSchemes;
    }
  } catch(e) {
    console.log('ç„¡æ³•è¼‰å…¥æ–¹æ¡ˆ');
  }
}

function displaySchemes() {
  let html = '';
  let count = 0;
  for (let name in savedSchemes) {
    count++;
    html += `
      <div style="padding: 1em; background: #f8f9fa; margin: 0.5em 0; border-radius: 8px; border-left: 4px solid #3498db; display: flex; justify-content: space-between; align-items: center;">
        <div>
          <strong>${name}</strong><br>
          <small style="color: #7f8c8d;">${savedSchemes[name].time}</small>
        </div>
        <div>
          <button onclick="loadScheme('${name}')" class="success" style="padding: 6px 12px; margin-right: 0.5em;">è¼‰å…¥</button>
          <button onclick="deleteScheme('${name}')" class="danger" style="padding: 6px 12px;">åˆªé™¤</button>
        </div>
      </div>
    `;
  }
  document.getElementById('savedSchemes').innerHTML = html || '<p style="color: #7f8c8d;">å°šç„¡ä¿å­˜çš„æ–¹æ¡ˆ</p>';
}

function loadScheme(name) {
  if (!savedSchemes[name]) return;
  window.currentData = savedSchemes[name].data;
  loadFromMemory();
  calcAll();
  closeModal('loadModal');
  alert('âœ… å·²è¼‰å…¥æ–¹æ¡ˆï¼š' + name);
}

function deleteScheme(name) {
  if (confirm('ç¢ºå®šè¦åˆªé™¤æ–¹æ¡ˆã€Œ' + name + 'ã€å—ï¼Ÿ')) {
    delete savedSchemes[name];
    window.savedSchemes = savedSchemes;
    displaySchemes();
    alert('âœ… å·²åˆªé™¤æ–¹æ¡ˆ');
  }
}

// ========== æ¨¡æ…‹æ¡†æ§åˆ¶ ==========
function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}

document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', function(e) {
    if (e.target === this) {
      this.style.display = 'none';
    }
  });
});
</script>
</body>
</html>
