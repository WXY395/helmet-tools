<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è¨‚å–®ç®¡ç†ç³»çµ±</title>
<style>
* { box-sizing: border-box; }
body { 
  font-family: "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
  background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%);
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 1400px;
  margin: 0 auto;
  background: white;
  padding: 2em;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2em;
  padding-bottom: 1em;
  border-bottom: 3px solid #ff6a88;
  flex-wrap: wrap;
  gap: 1em;
}
h2 { color: #2c3e50; margin: 0; }
.status-tabs {
  display: flex;
  gap: 0.5em;
  margin-bottom: 1.5em;
  flex-wrap: wrap;
}
.status-tab {
  padding: 10px 20px;
  border: 2px solid #ff6a88;
  background: white;
  color: #ff6a88;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 0.5em;
}
.status-tab.active {
  background: #ff6a88;
  color: white;
}
.status-badge {
  background: white;
  color: #ff6a88;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.9em;
}
.status-tab.active .status-badge {
  background: rgba(255,255,255,0.3);
  color: white;
}
.order-card {
  background: white;
  border-radius: 12px;
  padding: 1.5em;
  margin-bottom: 1em;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  border-left: 5px solid #ff6a88;
  transition: all 0.3s;
}
.order-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}
.order-card.pending { border-left-color: #f39c12; }
.order-card.processing { border-left-color: #3498db; }
.order-card.shipped { border-left-color: #9b59b6; }
.order-card.completed { border-left-color: #27ae60; }
.order-card.cancelled { border-left-color: #e74c3c; }
.order-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1em;
  flex-wrap: wrap;
  gap: 0.5em;
}
.order-number {
  font-size: 1.2em;
  font-weight: bold;
  color: #2c3e50;
}
.order-date {
  color: #7f8c8d;
  font-size: 0.9em;
}
.order-status {
  display: inline-block;
  padding: 5px 15px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.9em;
}
.status-pending { background: #fff3cd; color: #856404; }
.status-processing { background: #d1ecf1; color: #0c5460; }
.status-shipped { background: #e2d5f0; color: #6c3483; }
.status-completed { background: #d4edda; color: #155724; }
.status-cancelled { background: #f8d7da; color: #721c24; }
.order-body {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 1.5em;
  margin-bottom: 1em;
}
.order-items {
  background: #f8f9fa;
  padding: 1em;
  border-radius: 8px;
}
.order-item {
  padding: 0.5em 0;
  border-bottom: 1px solid #dee2e6;
}
.order-item:last-child {
  border-bottom: none;
}
.item-name {
  font-weight: bold;
  color: #2c3e50;
}
.item-price {
  color: #7f8c8d;
  font-size: 0.95em;
}
.order-customer {
  background: #fff9e6;
  padding: 1em;
  border-radius: 8px;
}
.customer-info {
  margin: 0.5em 0;
  font-size: 0.95em;
}
.customer-label {
  color: #7f8c8d;
  display: inline-block;
  width: 60px;
}
.order-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 1em;
  border-top: 1px solid #dee2e6;
  flex-wrap: wrap;
  gap: 1em;
}
.order-total {
  font-size: 1.3em;
  font-weight: bold;
  color: #ff6a88;
}
.order-actions {
  display: flex;
  gap: 0.5em;
  flex-wrap: wrap;
}
button {
  background: #ff6a88;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 0.9em;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
button.success { background: #27ae60; }
button.warning { background: #f39c12; }
button.danger { background: #e74c3c; }
button.info { background: #3498db; }
.search-box {
  margin-bottom: 1.5em;
  position: relative;
}
.search-box input {
  width: 100%;
  padding: 12px 12px 12px 45px;
  border: 2px solid #ddd;
  border-radius: 25px;
  font-size: 1em;
}
.search-icon {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2em;
  color: #7f8c8d;
}
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  overflow-y: auto;
}
.modal-content {
  background: white;
  padding: 2em;
  border-radius: 15px;
  max-width: 600px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  margin: 2em;
}
input, select, textarea {
  width: 100%;
  padding: 10px;
  margin: 0.5em 0;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 1em;
  font-family: inherit;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #ff6a88;
}
.item-row {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr auto;
  gap: 0.5em;
  margin-bottom: 0.5em;
  align-items: center;
}
.quick-add {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ff9a56, #ff6a88);
  color: white;
  font-size: 2em;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  cursor: pointer;
  transition: all 0.3s;
  z-index: 100;
}
.quick-add:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 30px rgba(0,0,0,0.4);
}
.empty-state {
  text-align: center;
  padding: 3em;
  color: #7f8c8d;
}
.empty-icon {
  font-size: 4em;
  margin-bottom: 0.5em;
}
@media (max-width: 768px) {
  .container { padding: 1em; }
  .order-body { grid-template-columns: 1fr; }
  .item-row { grid-template-columns: 1fr; }
  .order-footer { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h2>ğŸ“‹ è¨‚å–®ç®¡ç†ç³»çµ±</h2>
    <div style="display: flex; gap: 0.5em; flex-wrap: wrap;">
      <button onclick="exportOrders()" class="warning">ğŸ“Š åŒ¯å‡ºè¨‚å–®</button>
      <button onclick="showStats()" class="info">ğŸ“ˆ çµ±è¨ˆ</button>
    </div>
  </div>

  <div class="search-box">
    <span class="search-icon">ğŸ”</span>
    <input type="text" id="searchInput" placeholder="æœå°‹è¨‚å–®ç·¨è™Ÿã€å®¢æˆ¶å§“åã€é›»è©±ã€å•†å“...">
  </div>

  <div class="status-tabs">
    <div class="status-tab active" onclick="filterStatus('all')">
      å…¨éƒ¨è¨‚å–® <span class="status-badge" id="countAll">0</span>
    </div>
    <div class="status-tab" onclick="filterStatus('pending')">
      å¾…è™•ç† <span class="status-badge" id="countPending">0</span>
    </div>
    <div class="status-tab" onclick="filterStatus('processing')">
      è™•ç†ä¸­ <span class="status-badge" id="countProcessing">0</span>
    </div>
    <div class="status-tab" onclick="filterStatus('shipped')">
      å·²å‡ºè²¨ <span class="status-badge" id="countShipped">0</span>
    </div>
    <div class="status-tab" onclick="filterStatus('completed')">
      å·²å®Œæˆ <span class="status-badge" id="countCompleted">0</span>
    </div>
    <div class="status-tab" onclick="filterStatus('cancelled')">
      å·²å–æ¶ˆ <span class="status-badge" id="countCancelled">0</span>
    </div>
  </div>

  <div id="ordersList">
    <div class="empty-state">
      <div class="empty-icon">ğŸ“¦</div>
      <h3>ç›®å‰æ²’æœ‰è¨‚å–®</h3>
      <p>é»æ“Šå³ä¸‹è§’ã€Œâ•ã€æ–°å¢ç¬¬ä¸€ç­†è¨‚å–®</p>
    </div>
  </div>
</div>

<div class="quick-add" onclick="showAddOrder()" title="æ–°å¢è¨‚å–®">â•</div>

<!-- æ–°å¢/ç·¨è¼¯è¨‚å–® Modal -->
<div id="orderModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">æ–°å¢è¨‚å–®</h3>
    <input type="hidden" id="orderId">
    
    <label>è¨‚å–®æ—¥æœŸï¼š</label>
    <input type="date" id="orderDate">
    
    <h4 style="margin-top: 1.5em; color: #2c3e50; border-bottom: 2px solid #ff6a88; padding-bottom: 0.5em;">ğŸ‘¤ å®¢æˆ¶è³‡è¨Š</h4>
    
    <label>å®¢æˆ¶å§“åï¼š</label>
    <input type="text" id="customerName" placeholder="å¿…å¡«">
    
    <label>è¯çµ¡é›»è©±ï¼š</label>
    <input type="tel" id="customerPhone" placeholder="å¿…å¡«">
    
    <label>æ”¶ä»¶åœ°å€ï¼š</label>
    <textarea id="customerAddress" rows="2" placeholder="å¿…å¡«"></textarea>
    
    <label>å‚™è¨»ï¼š</label>
    <input type="text" id="customerNote" placeholder="é¸å¡«">
    
    <h4 style="margin-top: 1.5em; color: #2c3e50; border-bottom: 2px solid #ff6a88; padding-bottom: 0.5em;">ğŸ›’ è¨‚è³¼å•†å“</h4>
    
    <div id="itemsContainer">
      <div class="item-row">
        <input type="text" placeholder="å•†å“åç¨±" class="item-name-input">
        <input type="number" placeholder="å–®åƒ¹" class="item-price-input" min="0" value="0">
        <input type="number" placeholder="æ•¸é‡" class="item-qty-input" min="1" value="1">
        <button onclick="removeItem(this)" class="danger" style="padding: 10px;">ğŸ—‘ï¸</button>
      </div>
    </div>
    
    <button onclick="addItemRow()" class="success" style="margin-bottom: 1em;">â• æ–°å¢å•†å“</button>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em;">
      <div>
        <label>é‹è²»ï¼š</label>
        <input type="number" id="shippingFee" value="60" min="0">
      </div>
      <div>
        <label>æŠ˜æ‰£ï¼š</label>
        <input type="number" id="discount" value="0" min="0">
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; margin: 1em 0;">
      <strong>è¨‚å–®ç¸½é¡ï¼š<span id="modalTotal" style="font-size: 1.3em; color: #ff6a88;">$0</span></strong>
    </div>
    
    <label>è¨‚å–®ç‹€æ…‹ï¼š</label>
    <select id="orderStatus">
      <option value="pending">å¾…è™•ç†</option>
      <option value="processing">è™•ç†ä¸­</option>
      <option value="shipped">å·²å‡ºè²¨</option>
      <option value="completed">å·²å®Œæˆ</option>
      <option value="cancelled">å·²å–æ¶ˆ</option>
    </select>
    
    <div style="margin-top: 1.5em; display: flex; gap: 1em;">
      <button onclick="saveOrder()" class="success">ğŸ’¾ ä¿å­˜è¨‚å–®</button>
      <button onclick="closeModal()">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<!-- è¨‚å–®è©³æƒ… Modal -->
<div id="detailModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ“‹ è¨‚å–®è©³æƒ…</h3>
    <div id="orderDetail"></div>
    <button onclick="closeModal()" style="margin-top: 1em; width: 100%;">é—œé–‰</button>
  </div>
</div>

<script>
let orders = [];
let currentFilter = 'all';

window.onload = function() {
  loadOrders();
  updateCounts();
  renderOrders();
  document.getElementById('orderDate').valueAsDate = new Date();
  document.getElementById('searchInput').addEventListener('input', renderOrders);
  
  // ç›£è½å•†å“æ¬„ä½è®ŠåŒ–è¨ˆç®—ç¸½é¡
  document.getElementById('itemsContainer').addEventListener('input', calculateModalTotal);
  document.getElementById('shippingFee').addEventListener('input', calculateModalTotal);
  document.getElementById('discount').addEventListener('input', calculateModalTotal);
};

function loadOrders() {
  try {
    if (window.ordersData) {
      orders = window.ordersData;
    }
  } catch(e) {
    console.log('è¼‰å…¥è¨‚å–®å¤±æ•—');
  }
}

function saveOrders() {
  try {
    window.ordersData = orders;
  } catch(e) {
    console.log('ä¿å­˜è¨‚å–®å¤±æ•—');
  }
}

function showAddOrder() {
  document.getElementById('modalTitle').textContent = 'æ–°å¢è¨‚å–®';
  document.getElementById('orderId').value = '';
  document.getElementById('orderDate').valueAsDate = new Date();
  document.getElementById('customerName').value = '';
  document.getElementById('customerPhone').value = '';
  document.getElementById('customerAddress').value = '';
  document.getElementById('customerNote').value = '';
  document.getElementById('shippingFee').value = '60';
  document.getElementById('discount').value = '0';
  document.getElementById('orderStatus').value = 'pending';
  
  document.getElementById('itemsContainer').innerHTML = `
    <div class="item-row">
      <input type="text" placeholder="å•†å“åç¨±" class="item-name-input">
      <input type="number" placeholder="å–®åƒ¹" class="item-price-input" min="0" value="0">
      <input type="number" placeholder="æ•¸é‡" class="item-qty-input" min="1" value="1">
      <button onclick="removeItem(this)" class="danger" style="padding: 10px;">ğŸ—‘ï¸</button>
    </div>
  `;
  
  calculateModalTotal();
  document.getElementById('orderModal').style.display = 'flex';
}

function addItemRow() {
  let row = document.createElement('div');
  row.className = 'item-row';
  row.innerHTML = `
    <input type="text" placeholder="å•†å“åç¨±" class="item-name-input">
    <input type="number" placeholder="å–®åƒ¹" class="item-price-input" min="0" value="0">
    <input type="number" placeholder="æ•¸é‡" class="item-qty-input" min="1" value="1">
    <button onclick="removeItem(this)" class="danger" style="padding: 10px;">ğŸ—‘ï¸</button>
  `;
  document.getElementById('itemsContainer').appendChild(row);
  calculateModalTotal();
}

function removeItem(btn) {
  if (document.querySelectorAll('.item-row').length > 1) {
    btn.parentElement.remove();
    calculateModalTotal();
  } else {
    alert('è‡³å°‘éœ€è¦ä¸€å€‹å•†å“ï¼');
  }
}

function calculateModalTotal() {
  let total = 0;
  
  document.querySelectorAll('.item-row').forEach(row => {
    let price = parseFloat(row.querySelector('.item-price-input').value) || 0;
    let qty = parseInt(row.querySelector('.item-qty-input').value) || 0;
    total += price * qty;
  });
  
  let shipping = parseFloat(document.getElementById('shippingFee').value) || 0;
  let discount = parseFloat(document.getElementById('discount').value) || 0;
  
  total = total + shipping - discount;
  document.getElementById('modalTotal').textContent = ' + total.toFixed(0);
}

function saveOrder() {
  let id = document.getElementById('orderId').value;
  
  let customerName = document.getElementById('customerName').value.trim();
  let customerPhone = document.getElementById('customerPhone').value.trim();
  let customerAddress = document.getElementById('customerAddress').value.trim();
  
  if (!customerName || !customerPhone || !customerAddress) {
    alert('è«‹å¡«å¯«å®Œæ•´çš„å®¢æˆ¶è³‡è¨Šï¼');
    return;
  }
  
  let items = [];
  document.querySelectorAll('.item-row').forEach(row => {
    let name = row.querySelector('.item-name-input').value.trim();
    let price = parseFloat(row.querySelector('.item-price-input').value) || 0;
    let qty = parseInt(row.querySelector('.item-qty-input').value) || 1;
    
    if (name) {
      items.push({ name, price, qty, subtotal: price * qty });
    }
  });
  
  if (items.length === 0) {
    alert('è«‹è‡³å°‘æ–°å¢ä¸€å€‹å•†å“ï¼');
    return;
  }
  
  let itemsTotal = items.reduce((sum, item) => sum + item.subtotal, 0);
  let shipping = parseFloat(document.getElementById('shippingFee').value) || 0;
  let discount = parseFloat(document.getElementById('discount').value) || 0;
  let total = itemsTotal + shipping - discount;
  
  let order = {
    id: id || 'ORD' + Date.now(),
    date: document.getElementById('orderDate').value,
    customer: {
      name: customerName,
      phone: customerPhone,
      address: customerAddress,
      note: document.getElementById('customerNote').value.trim()
    },
    items: items,
    shipping: shipping,
    discount: discount,
    total: total,
    status: document.getElementById('orderStatus').value,
    createdAt: id ? orders.find(o => o.id === id).createdAt : new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };
  
  if (id) {
    let index = orders.findIndex(o => o.id === id);
    orders[index] = order;
  } else {
    orders.unshift(order);
  }
  
  saveOrders();
  updateCounts();
  renderOrders();
  closeModal();
  alert('âœ… è¨‚å–®å·²ä¿å­˜ï¼');
}

function editOrder(id) {
  let order = orders.find(o => o.id === id);
  if (!order) return;
  
  document.getElementById('modalTitle').textContent = 'ç·¨è¼¯è¨‚å–®';
  document.getElementById('orderId').value = order.id;
  document.getElementById('orderDate').value = order.date;
  document.getElementById('customerName').value = order.customer.name;
  document.getElementById('customerPhone').value = order.customer.phone;
  document.getElementById('customerAddress').value = order.customer.address;
  document.getElementById('customerNote').value = order.customer.note || '';
  document.getElementById('shippingFee').value = order.shipping;
  document.getElementById('discount').value = order.discount;
  document.getElementById('orderStatus').value = order.status;
  
  document.getElementById('itemsContainer').innerHTML = '';
  order.items.forEach(item => {
    let row = document.createElement('div');
    row.className = 'item-row';
    row.innerHTML = `
      <input type="text" placeholder="å•†å“åç¨±" class="item-name-input" value="${item.name}">
      <input type="number" placeholder="å–®åƒ¹" class="item-price-input" min="0" value="${item.price}">
      <input type="number" placeholder="æ•¸é‡" class="item-qty-input" min="1" value="${item.qty}">
      <button onclick="removeItem(this)" class="danger" style="padding: 10px;">ğŸ—‘ï¸</button>
    `;
    document.getElementById('itemsContainer').appendChild(row);
  });
  
  calculateModalTotal();
  document.getElementById('orderModal').style.display = 'flex';
}

function updateOrderStatus(id, newStatus) {
  let order = orders.find(o => o.id === id);
  if (!order) return;
  
  let statusNames = {
    pending: 'å¾…è™•ç†',
    processing: 'è™•ç†ä¸­',
    shipped: 'å·²å‡ºè²¨',
    completed: 'å·²å®Œæˆ',
    cancelled: 'å·²å–æ¶ˆ'
  };
  
  if (confirm(`ç¢ºå®šè¦å°‡è¨‚å–® ${order.id} æ›´æ–°ç‚ºã€Œ${statusNames[newStatus]}ã€å—ï¼Ÿ`)) {
    order.status = newStatus;
    order.updatedAt = new Date().toISOString();
    saveOrders();
    updateCounts();
    renderOrders();
    alert('âœ… è¨‚å–®ç‹€æ…‹å·²æ›´æ–°ï¼');
  }
}

function deleteOrder(id) {
  let order = orders.find(o => o.id === id);
  if (!order) return;
  
  if (confirm(`ç¢ºå®šè¦åˆªé™¤è¨‚å–® ${order.id} å—ï¼Ÿ\nå®¢æˆ¶ï¼š${order.customer.name}\nç¸½é¡ï¼š${order.total}\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) {
    orders = orders.filter(o => o.id !== id);
    saveOrders();
    updateCounts();
    renderOrders();
    alert('âœ… è¨‚å–®å·²åˆªé™¤');
  }
}

function showOrderDetail(id) {
  let order = orders.find(o => o.id === id);
  if (!order) return;
  
  let statusNames = {
    pending: 'å¾…è™•ç†',
    processing: 'è™•ç†ä¸­',
    shipped: 'å·²å‡ºè²¨',
    completed: 'å·²å®Œæˆ',
    cancelled: 'å·²å–æ¶ˆ'
  };
  
  let statusClasses = {
    pending: 'status-pending',
    processing: 'status-processing',
    shipped: 'status-shipped',
    completed: 'status-completed',
    cancelled: 'status-cancelled'
  };
  
  let itemsHtml = order.items.map(item => `
    <div style="padding: 0.5em 0; border-bottom: 1px solid #dee2e6;">
      <strong>${item.name}</strong><br>
      <span style="color: #7f8c8d;">${item.price} Ã— ${item.qty} = ${item.subtotal}</span>
    </div>
  `).join('');
  
  let html = `
    <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; margin-bottom: 1em;">
      <strong style="font-size: 1.2em;">${order.id}</strong><br>
      <span style="color: #7f8c8d;">${order.date}</span>
      <span class="order-status ${statusClasses[order.status]}" style="margin-left: 1em;">${statusNames[order.status]}</span>
    </div>
    
    <h4 style="color: #2c3e50; border-bottom: 2px solid #ff6a88; padding-bottom: 0.5em;">ğŸ‘¤ å®¢æˆ¶è³‡è¨Š</h4>
    <div style="background: #fff9e6; padding: 1em; border-radius: 8px; margin-bottom: 1em;">
      <div style="margin: 0.5em 0;"><strong>å§“åï¼š</strong>${order.customer.name}</div>
      <div style="margin: 0.5em 0;"><strong>é›»è©±ï¼š</strong>${order.customer.phone}</div>
      <div style="margin: 0.5em 0;"><strong>åœ°å€ï¼š</strong>${order.customer.address}</div>
      ${order.customer.note ? `<div style="margin: 0.5em 0;"><strong>å‚™è¨»ï¼š</strong>${order.customer.note}</div>` : ''}
    </div>
    
    <h4 style="color: #2c3e50; border-bottom: 2px solid #ff6a88; padding-bottom: 0.5em;">ğŸ›’ è¨‚è³¼å•†å“</h4>
    <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; margin-bottom: 1em;">
      ${itemsHtml}
    </div>
    
    <div style="background: #e8f4f8; padding: 1em; border-radius: 8px;">
      <div style="display: flex; justify-content: space-between; margin: 0.5em 0;">
        <span>å•†å“å°è¨ˆï¼š</span>
        <strong>${order.items.reduce((sum, item) => sum + item.subtotal, 0)}</strong>
      </div>
      <div style="display: flex; justify-content: space-between; margin: 0.5em 0;">
        <span>é‹è²»ï¼š</span>
        <strong>${order.shipping}</strong>
      </div>
      ${order.discount > 0 ? `
      <div style="display: flex; justify-content: space-between; margin: 0.5em 0; color: #e74c3c;">
        <span>æŠ˜æ‰£ï¼š</span>
        <strong>-${order.discount}</strong>
      </div>` : ''}
      <div style="display: flex; justify-content: space-between; margin-top: 1em; padding-top: 1em; border-top: 2px solid #dee2e6; font-size: 1.3em;">
        <span><strong>è¨‚å–®ç¸½é¡ï¼š</strong></span>
        <strong style="color: #ff6a88;">${order.total}</strong>
      </div>
    </div>
  `;
  
  document.getElementById('orderDetail').innerHTML = html;
  document.getElementById('detailModal').style.display = 'flex';
}

function filterStatus(status) {
  currentFilter = status;
  document.querySelectorAll('.status-tab').forEach(tab => tab.classList.remove('active'));
  event.target.closest('.status-tab').classList.add('active');
  renderOrders();
}

function updateCounts() {
  document.getElementById('countAll').textContent = orders.length;
  document.getElementById('countPending').textContent = orders.filter(o => o.status === 'pending').length;
  document.getElementById('countProcessing').textContent = orders.filter(o => o.status === 'processing').length;
  document.getElementById('countShipped').textContent = orders.filter(o => o.status === 'shipped').length;
  document.getElementById('countCompleted').textContent = orders.filter(o => o.status === 'completed').length;
  document.getElementById('countCancelled').textContent = orders.filter(o => o.status === 'cancelled').length;
}

function renderOrders() {
  let searchTerm = document.getElementById('searchInput').value.toLowerCase();
  
  let filtered = orders.filter(order => {
    let matchStatus = currentFilter === 'all' || order.status === currentFilter;
    let matchSearch = order.id.toLowerCase().includes(searchTerm) ||
                     order.customer.name.toLowerCase().includes(searchTerm) ||
                     order.customer.phone.includes(searchTerm) ||
                     order.items.some(item => item.name.toLowerCase().includes(searchTerm));
    return matchStatus && matchSearch;
  });
  
  let html = '';
  
  if (filtered.length === 0) {
    html = `
      <div class="empty-state">
        <div class="empty-icon">ğŸ“¦</div>
        <h3>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è¨‚å–®</h3>
        <p>è©¦è©¦èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–æœå°‹é—œéµå­—</p>
      </div>
    `;
  } else {
    filtered.forEach(order => {
      let statusNames = {
        pending: 'å¾…è™•ç†',
        processing: 'è™•ç†ä¸­',
        shipped: 'å·²å‡ºè²¨',
        completed: 'å·²å®Œæˆ',
        cancelled: 'å·²å–æ¶ˆ'
      };
      
      let statusClasses = {
        pending: 'status-pending',
        processing: 'status-processing',
        shipped: 'status-shipped',
        completed: 'status-completed',
        cancelled: 'status-cancelled'
      };
      
      let itemsList = order.items.slice(0, 3).map(item => 
        `<div class="order-item"><span class="item-name">${item.name}</span> <span class="item-price">Ã— ${item.qty}</span></div>`
      ).join('');
      
      if (order.items.length > 3) {
        itemsList += `<div class="order-item" style="color: #7f8c8d;">... é‚„æœ‰ ${order.items.length - 3} é …å•†å“</div>`;
      }
      
      html += `
        <div class="order-card ${order.status}">
          <div class="order-header">
            <div>
              <div class="order-number">${order.id}</div>
              <div class="order-date">${order.date}</div>
            </div>
            <span class="order-status ${statusClasses[order.status]}">${statusNames[order.status]}</span>
          </div>
          
          <div class="order-body">
            <div class="order-items">
              <strong style="color: #2c3e50; display: block; margin-bottom: 0.5em;">è¨‚è³¼å•†å“ï¼š</strong>
              ${itemsList}
            </div>
            
            <div class="order-customer">
              <strong style="color: #2c3e50; display: block; margin-bottom: 0.5em;">å®¢æˆ¶è³‡è¨Šï¼š</strong>
              <div class="customer-info">
                <span class="customer-label">å§“åï¼š</span>${order.customer.name}
              </div>
              <div class="customer-info">
                <span class="customer-label">é›»è©±ï¼š</span>${order.customer.phone}
              </div>
              <div class="customer-info">
                <span class="customer-label">åœ°å€ï¼š</span>${order.customer.address}
              </div>
            </div>
          </div>
          
          <div class="order-footer">
            <div class="order-total">ç¸½é¡ï¼š${order.total}</div>
            <div class="order-actions">
              ${order.status === 'pending' ? `
                <button onclick="updateOrderStatus('${order.id}', 'processing')" class="info">âœ… é–‹å§‹è™•ç†</button>
              ` : ''}
              ${order.status === 'processing' ? `
                <button onclick="updateOrderStatus('${order.id}', 'shipped')" class="warning">ğŸšš æ¨™è¨˜å‡ºè²¨</button>
              ` : ''}
              ${order.status === 'shipped' ? `
                <button onclick="updateOrderStatus('${order.id}', 'completed')" class="success">âœ… å®Œæˆè¨‚å–®</button>
              ` : ''}
              <button onclick="showOrderDetail('${order.id}')" class="info">ğŸ‘ï¸ è©³æƒ…</button>
              <button onclick="editOrder('${order.id}')" class="warning">âœï¸ ç·¨è¼¯</button>
              <button onclick="deleteOrder('${order.id}')" class="danger">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      `;
    });
  }
  
  document.getElementById('ordersList').innerHTML = html;
}

function exportOrders() {
  if (orders.length === 0) {
    alert('ç›®å‰æ²’æœ‰è¨‚å–®å¯ä»¥åŒ¯å‡ºï¼');
    return;
  }
  
  let csv = 'è¨‚å–®ç·¨è™Ÿ,æ—¥æœŸ,å®¢æˆ¶å§“å,è¯çµ¡é›»è©±,æ”¶ä»¶åœ°å€,å•†å“æ¸…å–®,å•†å“ç¸½è¨ˆ,é‹è²»,æŠ˜æ‰£,è¨‚å–®ç¸½é¡,ç‹€æ…‹,å‚™è¨»\n';
  
  orders.forEach(order => {
    let itemsList = order.items.map(item => `${item.name}(${item.qty})`).join(';');
    let itemsTotal = order.items.reduce((sum, item) => sum + item.subtotal, 0);
    let statusNames = {
      pending: 'å¾…è™•ç†',
      processing: 'è™•ç†ä¸­',
      shipped: 'å·²å‡ºè²¨',
      completed: 'å·²å®Œæˆ',
      cancelled: 'å·²å–æ¶ˆ'
    };
    
    csv += `"${order.id}","${order.date}","${order.customer.name}","${order.customer.phone}","${order.customer.address}","${itemsList}",${itemsTotal},${order.shipping},${order.discount},${order.total},${statusNames[order.status]},"${order.customer.note || ''}"\n`;
  });
  
  let blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
  let link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'è¨‚å–®æ˜ç´°_' + new Date().toLocaleDateString('zh-TW') + '.csv';
  link.click();
  
  alert('âœ… è¨‚å–®è³‡æ–™å·²åŒ¯å‡ºï¼');
}

function showStats() {
  if (orders.length === 0) {
    alert('ç›®å‰æ²’æœ‰è¨‚å–®è³‡æ–™ï¼');
    return;
  }
  
  let total = orders.reduce((sum, order) => sum + order.total, 0);
  let completed = orders.filter(o => o.status === 'completed');
  let completedTotal = completed.reduce((sum, order) => sum + order.total, 0);
  let pending = orders.filter(o => o.status === 'pending').length;
  let processing = orders.filter(o => o.status === 'processing').length;
  let shipped = orders.filter(o => o.status === 'shipped').length;
  
  let message = `ğŸ“Š è¨‚å–®çµ±è¨ˆ\n\n`;
  message += `ç¸½è¨‚å–®æ•¸ï¼š${orders.length} ç­†\n`;
  message += `è¨‚å–®ç¸½é¡ï¼š${total.toFixed(0)}\n\n`;
  message += `å·²å®Œæˆï¼š${completed.length} ç­† (${completedTotal.toFixed(0)})\n`;
  message += `å¾…è™•ç†ï¼š${pending} ç­†\n`;
  message += `è™•ç†ä¸­ï¼š${processing} ç­†\n`;
  message += `å·²å‡ºè²¨ï¼š${shipped} ç­†\n\n`;
  message += `å¹³å‡å®¢å–®åƒ¹ï¼š${(total / orders.length).toFixed(0)}`;
  
  alert(message);
}

function closeModal() {
  document.getElementById('orderModal').style.display = 'none';
  document.getElementById('detailModal').style.display = 'none';
}

document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
});
</script>
</body>
</html>